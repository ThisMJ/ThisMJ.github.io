<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RxJava-理解响应式编程</title>
      <link href="/2019/03/26/rxjava-li-jie-xiang-ying-shi-bian-cheng/"/>
      <url>/2019/03/26/rxjava-li-jie-xiang-ying-shi-bian-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>如何系统地学习一个优秀的开源框架？我认为比较正确的方式应该是，先了解它的设计思想，然后学会如何去使用它，最后通过阅读源码来弄清楚它的实现原理。所以在学习 RxJava 之前，我们需要先对响应式编程有个大概的理解。</p><h2 id="编程范式"><a href="#编程范式" class="headerlink" title="编程范式"></a>编程范式</h2><p><a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%9E%8B" target="_blank" rel="noopener">编程范式</a>是如何编写程序的方法论，它提供了一种编程规范（风格），来指导我们进行程序的设计。比较常见的编程范式有命令式、声明式、面向对象、函数式等。</p><h3 id="命令式编程"><a href="#命令式编程" class="headerlink" title="命令式编程"></a>命令式编程</h3><p>我们最熟悉的一种编程方式，与<a href="https://mp.weixin.qq.com/s?__biz=MzAxOTc0NzExNg==&amp;mid=2665513341&amp;idx=1&amp;sn=4e2ddfccb58eb8ef85053cd9b4417467&amp;chksm=80d6793eb7a1f02810f4091efa0add91ea4a182af33593a55ea2e25618fe85817c7877f6a63c&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">冯·诺伊曼</a>计算机结构密切相关。简单来说就是我们使用变量（var）、条件分支（if）、无条件分支（goto）、循环（for 、while）等，一步一步告诉计算机该如何去做（how）。比如我们要计算 1～10 中所有奇数之和，用命令式编程风格是这样的：</p><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">imperative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//循环</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> num <span class="token operator">:</span> array<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">//条件分支</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                sum <span class="token operator">+=</span> num<span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> sum<span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h3 id="声明式编程"><a href="#声明式编程" class="headerlink" title="声明式编程"></a>声明式编程</h3><p>一种更为抽象的编程方式，我们只需要声明想做什么，只关注结果（what），至于具体怎么去做（how），则不需要关心，像SQL、HTML等都是声明式的。当然，针对上面的例子，我们也可以用 Java 8 中的 Streams API 来进行声明式地编程：</p><pre class=" language-java"><code class="language-java">   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">declarative</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> Stream<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>x <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Integer<span class="token operator">:</span><span class="token operator">:</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h2 id="理解响应式"><a href="#理解响应式" class="headerlink" title="理解响应式"></a>理解响应式</h2><p>响应式编程(Reactive programming)是最近几年才流行起来的，它是<strong>一种通过异步和数据流来构建事务关系的编程范式</strong>。关于响应式的思想，可以从维基百科的一个例子来说明：</p><pre class=" language-java"><code class="language-java">a <span class="token operator">=</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span></code></pre><p>在命令式编程环境中，当 b 或 c 的值发生改变时，a 的值不会受到影响；而响应式的思想就是，a 的值会随着 b、c 的值的更新而更新。遗憾的是，我们的程序设计语言并没有提供类似的操作符，如果要实现这样的功能，就需要花额外的精力去构建和维护 a 和 b、c 的关系（注意，这里的 a、b、c 不能简单地理解为基本类型的变量，它们也可以是一个对象、一段业务逻辑等等）。</p><p>既然有了响应式的思想，慢慢地一些支持这种思想的框架就应运而生了，例如 Rx 系列，Bacon.js，RAC 等。这里我们主要了解一下 Rx（Reactive Extensions），Rx 即支持响应式编程的一种拓展，为响应式在不同语言中的实现提供指导思想。所以，其实 RxJava 就是帮助我们在 Java 语言中进行响应式编程的框架。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>暂时先这样，等系统学习完 RxJava 之后再补充。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a href="https://www.reactivemanifesto.org/zh-CN" target="_blank" rel="noopener">响应式宣言</a></li><li><a href="https://www.jianshu.com/p/c95e29854cb1" target="_blank" rel="noopener">重新理解响应式编程</a></li><li><a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%9E%8B" target="_blank" rel="noopener">维基百科-编程范式</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%93%8D%E5%BA%94%E5%BC%8F%E7%BC%96%E7%A8%8B" target="_blank" rel="noopener">维基百科-响应式编程</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 响应式编程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AAPT源码分析(一)</title>
      <link href="/2019/03/15/aapt-yuan-ma-fen-xi-yi/"/>
      <url>/2019/03/15/aapt-yuan-ma-fen-xi-yi/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>通过 <a href="http://thismj.cn/2019/03/06/aapt-ming-ling-xing-shi-yong-shi-jian/" target="_blank" rel="noopener">AAPT命令行使用实践</a>，我们已经知道了如何去使用 aapt 这个工具。为了更详细地了解 aapt 的工作流程以及原理，我们接下来从源码的角度来分析一下，它是如何编译和打包项目资源文件的。aapt 相关源码的位置如下所示：</p><pre class=" language-bash"><code class="language-bash">AOSP/frameworks/base/tools/aapt/</code></pre><h2 id="主函数-main"><a href="#主函数-main" class="headerlink" title="主函数 main()"></a>主函数 main()</h2><p>在终端执行 appt 命令，首先会进入到 Main.cpp 的 main()函数：</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * 解析参数 */</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Bundle bundle<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'v'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'d'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandDump<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'l'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandList<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'a'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandAdd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'r'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandRemove<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'p'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandPackage<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'c'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandCrunch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'s'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandSingleCrunch<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'m'</span><span class="token punctuation">)</span>        bundle<span class="token punctuation">.</span><span class="token function">setCommand</span><span class="token punctuation">(</span>kCommandDaemon<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"ERROR: Unknown command '%s'\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        wantUsage <span class="token operator">=</span> true<span class="token punctuation">;</span>        <span class="token keyword">goto</span> bail<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>    </code></pre><p>在 main() 函数里面，通过命令行传过来的参数列表（字符指针数组），首先判断出执行的命令，由代码可知，只要命令参数的第一个字符成功匹配即可，所以 “aapt v” 跟 “aapt vOJBK”是一样的。</p><h2 id="Bundle-h-头文件"><a href="#Bundle-h-头文件" class="headerlink" title="Bundle.h 头文件"></a>Bundle.h 头文件</h2><p>这里有个比较重要的类Bundle，这个东西会贯穿在 aapt 的源码之中，它负责全局保存命令行参数列表解析的结果，如上，Bundle 通过 setCommand() 函数记录 aapt 的命令类型，kCommandVersion、kCommandPackage 等都是定义在 Bundle.h 头文件里面的枚举类型：</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * 命令枚举类型 */</span><span class="token keyword">typedef</span> <span class="token keyword">enum</span> Command <span class="token punctuation">{</span>    kCommandUnknown <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//对应 v[ersion]命令</span>    kCommandVersion<span class="token punctuation">,</span>    kCommandList<span class="token punctuation">,</span>    kCommandDump<span class="token punctuation">,</span>    kCommandAdd<span class="token punctuation">,</span>    kCommandRemove<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//对应 p[ackage]命令</span>    kCommandPackage<span class="token punctuation">,</span>    kCommandCrunch<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">//对应 s[ingleCrunch]命令</span>    kCommandSingleCrunch<span class="token punctuation">,</span>    kCommandDaemon<span class="token punctuation">}</span> Command<span class="token punctuation">;</span></code></pre><p>查看 Bundle 类的构造函数，每个变量都对应一个 aapt 的命令行参数：</p><pre class=" language-c"><code class="language-c">public<span class="token punctuation">:</span>    <span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>        <span class="token punctuation">:</span> <span class="token function">mCmd</span><span class="token punctuation">(</span>kCommandUnknown<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mVerbose</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mAndroidList</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mForce</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mGrayscaleTolerance</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mMakePackageDirs</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mUpdate</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mExtending</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mRequireLocalization</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mPseudolocalize</span><span class="token punctuation">(</span>NO_PSEUDOLOCALIZATION<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mWantUTF16</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mValues</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mIncludeMetaData</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mCompressionMethod</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mJunkPath</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mOutputAPKFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mManifestPackageNameOverride</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mInstrumentationPackageNameOverride</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mAutoAddOverlay</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mGenDependencies</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mNoVersionVectors</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mCrunchedOutputDir</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mProguardFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mMainDexProguardFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mAndroidManifestFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mPublicOutputFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mRClassDir</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mResourceIntermediatesDir</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mManifestMinSdkVersion</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mMinSdkVersion</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mTargetSdkVersion</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mMaxSdkVersion</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mVersionCode</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mVersionName</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mReplaceVersion</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mCustomPackage</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mExtraPackages</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mMaxResVersion</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mDebugMode</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mNonConstantId</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mSkipSymbolsWithoutDefaultLocalization</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mProduct</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mUseCrunchCache</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mErrorOnFailedInsert</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mErrorOnMissingConfigEntry</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mOutputTextSymbols</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mSingleCrunchInputFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mSingleCrunchOutputFile</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mBuildSharedLibrary</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mBuildAppAsSharedLibrary</span><span class="token punctuation">(</span>false<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">mArgc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">mArgv</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token operator">~</span><span class="token function">Bundle</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><p>判断完命令类型之后，main.cpp 的 main() 函数继续遍历解析参数列表，因为 aapt 的命令行参数众多，所以只截取部分代码片段如下：</p><pre class=" language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token keyword">const</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    Bundle bundle<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    argc <span class="token operator">-</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    argv <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/*     * 遍历参数列表     */</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>argc <span class="token operator">&amp;&amp;</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'-'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">/* 参数标记 */</span>        <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> cp <span class="token operator">=</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>cp <span class="token operator">!=</span> <span class="token string">'\0'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token operator">*</span>cp<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token string">'v'</span><span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">// -v 打印详细信息</span>                bundle<span class="token punctuation">.</span><span class="token function">setVerbose</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token keyword">case</span> <span class="token string">'F'</span><span class="token punctuation">:</span>                argc<span class="token operator">--</span><span class="token punctuation">;</span>                argv<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token comment" spellcheck="true">// -F 保存资源打包文件的输出路径</span>                bundle<span class="token punctuation">.</span><span class="token function">setOutputAPKFile</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token keyword">case</span> <span class="token string">'M'</span><span class="token punctuation">:</span>                argc<span class="token operator">--</span><span class="token punctuation">;</span>                argv<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token comment" spellcheck="true">// -M 保存 AndroidManifest 文件的路径</span>                bundle<span class="token punctuation">.</span><span class="token function">setAndroidManifestFile</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token string">'S'</span><span class="token punctuation">:</span>                argc<span class="token operator">--</span><span class="token punctuation">;</span>                argv<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token comment" spellcheck="true">// -S 添加资源文件夹</span>                bundle<span class="token punctuation">.</span><span class="token function">addResourceSourceDir</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token comment" spellcheck="true">//解析两条杠 -- 的参数</span>            <span class="token keyword">case</span> <span class="token string">'-'</span><span class="token punctuation">:</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cp<span class="token punctuation">,</span> <span class="token string">"-debug-mode"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// --debug-mode 开启 debug 模式</span>                    bundle<span class="token punctuation">.</span><span class="token function">setDebugMode</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cp<span class="token punctuation">,</span> <span class="token string">"-max-res-version"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    argc<span class="token operator">--</span><span class="token punctuation">;</span>                    argv<span class="token operator">++</span><span class="token punctuation">;</span>                    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                    <span class="token comment" spellcheck="true">// --max-res-version 如果指定为19，则类似drawable-v21的资源文件夹会被忽略</span>                    bundle<span class="token punctuation">.</span><span class="token function">setMaxResVersion</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                              <span class="token punctuation">}</span>                 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cp<span class="token punctuation">,</span> <span class="token string">"-auto-add-overlay"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//添加 overlay 独有的资源</span>                    bundle<span class="token punctuation">.</span><span class="token function">setAutoAddOverlay</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cp<span class="token punctuation">,</span> <span class="token string">"-no-crunch"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">//不对 PNG 进行预处理</span>                    bundle<span class="token punctuation">.</span><span class="token function">setUseCrunchCache</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>             cp<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        argc<span class="token operator">--</span><span class="token punctuation">;</span>        argv<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    result <span class="token operator">=</span> <span class="token function">handleCommand</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span></code></pre><p>需要注意一下 -S 这个参数，-S 可以指定多个资源文件夹，Bundle 用一个 类型为 Vector 的 mResourceSourceDirs 变量来保存，通过 addResourceSourceDir() 函数倒序添加这些指定的资源文件夹：</p><pre class=" language-c"><code class="language-c">class Bundle <span class="token punctuation">{</span>public<span class="token punctuation">:</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">const</span> android<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">&amp;</span> <span class="token function">getResourceSourceDirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token punctuation">{</span>         <span class="token keyword">return</span> mResourceSourceDirs<span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token keyword">void</span> <span class="token function">addResourceSourceDir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> dir<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//倒序添加，假设命令行依次指定了三个 -S 路径参数，分别为 A、B、C  </span>        <span class="token comment" spellcheck="true">//则 A 为 base 资源包，B 是 C 的 overlay 资源包，A 是 B 的 overlay 资源包</span>        mResourceSourceDirs<span class="token punctuation">.</span><span class="token function">insertAt</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>private<span class="token punctuation">:</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    android<span class="token punctuation">:</span><span class="token punctuation">:</span>Vector<span class="token operator">&lt;</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">></span> mResourceSourceDirs<span class="token punctuation">;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span></code></pre><h2 id="handleCommand"><a href="#handleCommand" class="headerlink" title="handleCommand()"></a>handleCommand()</h2><p>参数列表解析完成后，都全局保存在了 bundle 变量中，接着进入 Main.cpp 的 handleCommand() 函数，分发不同的命令类型：</p><pre class=" language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* * 分发命令. */</span><span class="token keyword">int</span> <span class="token function">handleCommand</span><span class="token punctuation">(</span>Bundle<span class="token operator">*</span> bundle<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>bundle<span class="token operator">-></span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> kCommandVersion<span class="token punctuation">:</span>      <span class="token keyword">return</span> <span class="token function">doVersion</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandList<span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token function">doList</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandDump<span class="token punctuation">:</span>         <span class="token keyword">return</span> <span class="token function">doDump</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandAdd<span class="token punctuation">:</span>          <span class="token keyword">return</span> <span class="token function">doAdd</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandRemove<span class="token punctuation">:</span>       <span class="token keyword">return</span> <span class="token function">doRemove</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandPackage<span class="token punctuation">:</span>      <span class="token keyword">return</span> <span class="token function">doPackage</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandCrunch<span class="token punctuation">:</span>       <span class="token keyword">return</span> <span class="token function">doCrunch</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandSingleCrunch<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token function">doSingleCrunch</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> kCommandDaemon<span class="token punctuation">:</span>       <span class="token keyword">return</span> <span class="token function">runInDaemonMode</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token punctuation">:</span>        <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%s: requested command not yet supported\n"</span><span class="token punctuation">,</span> gProgName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>根据不同的命令类型，调用不同的函数流程，比如 p 命令则执行 doPackage() 函数。</p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>时序图整理如下：</p><img src="http://www.plantuml.com/plantuml/svg/TLBBJW8n5DttAvgu0I9y00k2ekn8Z2PkZ8jBMvY6cNRI5jRAmfsFH4rC92J6XSI4g3kC2t-6GVmBEtG6GR2BtiUvz-I-ojg0Ckt0Hxh5HGWA0bm7qcegsHQq8dsfy4OrVhiB4O4KadXA1WmRrMO8MRVXX8SW3Au15mKIXXWq3go-16vRLfyLl1Yip_Gbk2A300HDquapKRuK4nMrntmV0J6y0uOvylZBbnnLCJOotFA0Qf9DJ3nGEKiYzCpJEJhE8Y5jfk9Dpo2Clq_Feuip1qsV7YVzg-YoExbzjT3Nn_MatukwWsXu5_K6uz79UFJigezUtgTl3-FH4351SKpuMrFIanFpkWgpzzUhcKdwpIGIau1cruGTCbMNccNgKlgu0_wwc2r1bUIq1e8tc3PLxhECQzsDeM4TAtb0wJxJigq8EvZzErmjPL6kilzquoQVhAZeGOob_RX1vP9nP15borjRi9E9pUrqvudCbufKxjcBX2PReKrZalkOVjv4z_r5yfIiR3TbZ_m7"><p>这篇主要分析了 aapt 命令行参数是如何进行解析的，涉及到的东西也比较简单。因为我们主要是想弄清楚 aapt 编译和打包项目资源文件的流程，所以，下一篇将从 doPackage() 函数开始，继续分析后续的流程。</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AAPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AAPT命令行使用实践</title>
      <link href="/2019/03/06/aapt-ming-ling-xing-shi-yong-shi-jian/"/>
      <url>/2019/03/06/aapt-ming-ling-xing-shi-yong-shi-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul><li>操作系统：Mac OS High Sierra 10.13.2 (17C88)</li><li>Android SDK Build Tool版本：28.0.3</li></ul><h2 id="AAPT是什么"><a href="#AAPT是什么" class="headerlink" title="AAPT是什么"></a>AAPT是什么</h2><p>AAPT 即 Android Asset Packaging Tool，它是 Android SDK 自带的一个命令行工具，是 Android 构建系统的一部分。AAPT可以查看、创建以及更新兼容 ZIP 格式的归档文件（.zip、.jar、.apk），在 Android 构建流程中，我们使用它来编译和打包项目的资源文件。</p><p>可以在下面两个地方找到aapt工具：</p><pre class=" language-bash"><code class="language-bash">Android SDK根目录/build-tools/xx.x.x/</code></pre><pre class=" language-bash"><code class="language-bash">AOSP/out/host/darwin-x86/bin/</code></pre><h2 id="AAPT命令行实践"><a href="#AAPT命令行实践" class="headerlink" title="AAPT命令行实践"></a>AAPT命令行实践</h2><p>在命令行直接输入aapt，不带任何参数，我们可以看到详细的帮助文档：</p><pre class=" language-bash"><code class="language-bash">➜ ~ aaptAndroid Asset Packaging ToolUsage: aapt l<span class="token punctuation">[</span>ist<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> <span class="token punctuation">[</span>-a<span class="token punctuation">]</span> file.<span class="token punctuation">{</span>zip,jar,apk<span class="token punctuation">}</span>   List contents of Zip-compatible archive. aapt d<span class="token punctuation">[</span>ump<span class="token punctuation">]</span> <span class="token punctuation">[</span>--values<span class="token punctuation">]</span> <span class="token punctuation">[</span>--include-meta-data<span class="token punctuation">]</span> WHAT file.<span class="token punctuation">{</span>apk<span class="token punctuation">}</span> <span class="token punctuation">[</span>asset <span class="token punctuation">[</span>asset <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>   strings          Print the contents of the resource table string pool <span class="token keyword">in</span> the APK.   badging          Print the label and icon <span class="token keyword">for</span> the app declared <span class="token keyword">in</span> APK.   permissions      Print the permissions from the APK.   resources        Print the resource table from the APK.   configurations   Print the configurations <span class="token keyword">in</span> the APK.   xmltree          Print the compiled xmls <span class="token keyword">in</span> the given assets.   xmlstrings       Print the strings of the given compiled xml assets. aapt p<span class="token punctuation">[</span>ackage<span class="token punctuation">]</span> <span class="token punctuation">[</span>-d<span class="token punctuation">]</span><span class="token punctuation">[</span>-f<span class="token punctuation">]</span><span class="token punctuation">[</span>-m<span class="token punctuation">]</span><span class="token punctuation">[</span>-u<span class="token punctuation">]</span><span class="token punctuation">[</span>-v<span class="token punctuation">]</span><span class="token punctuation">[</span>-x<span class="token punctuation">]</span><span class="token punctuation">[</span>-z<span class="token punctuation">]</span><span class="token punctuation">[</span>-M AndroidManifest.xml<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-0 extension <span class="token punctuation">[</span>-0 extension <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-g tolerance<span class="token punctuation">]</span> <span class="token punctuation">[</span>-j jarfile<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--debug-mode<span class="token punctuation">]</span> <span class="token punctuation">[</span>--min-sdk-version VAL<span class="token punctuation">]</span> <span class="token punctuation">[</span>--target-sdk-version VAL<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--app-version VAL<span class="token punctuation">]</span> <span class="token punctuation">[</span>--app-version-name TEXT<span class="token punctuation">]</span> <span class="token punctuation">[</span>--custom-package VAL<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--rename-manifest-package PACKAGE<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--rename-instrumentation-target-package PACKAGE<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--utf16<span class="token punctuation">]</span> <span class="token punctuation">[</span>--auto-add-overlay<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--max-res-version VAL<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-I base-package <span class="token punctuation">[</span>-I base-package <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-A asset-source-dir<span class="token punctuation">]</span>  <span class="token punctuation">[</span>-G class-list-file<span class="token punctuation">]</span> <span class="token punctuation">[</span>-P public-definitions-file<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-D main-dex-class-list-file<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-S resource-sources <span class="token punctuation">[</span>-S resource-sources <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-F apk-file<span class="token punctuation">]</span> <span class="token punctuation">[</span>-J R-file-dir<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--product product1,product2,<span class="token punctuation">..</span>.<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>-c CONFIGS<span class="token punctuation">]</span> <span class="token punctuation">[</span>--preferred-density DENSITY<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--split CONFIGS <span class="token punctuation">[</span>--split CONFIGS<span class="token punctuation">]</span><span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--feature-of package <span class="token punctuation">[</span>--feature-after package<span class="token punctuation">]</span><span class="token punctuation">]</span> \        <span class="token punctuation">[</span>raw-files-dir <span class="token punctuation">[</span>raw-files-dir<span class="token punctuation">]</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span> \        <span class="token punctuation">[</span>--output-text-symbols DIR<span class="token punctuation">]</span>   Package the android resources.  It will <span class="token function">read</span> assets and resources that are   supplied with the -M -A -S or raw-files-dir arguments.  The -J -P -F and -R   options control <span class="token function">which</span> files are output. aapt r<span class="token punctuation">[</span>emove<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> file.<span class="token punctuation">{</span>zip,jar,apk<span class="token punctuation">}</span> file1 <span class="token punctuation">[</span>file2 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>   Delete specified files from Zip-compatible archive. aapt a<span class="token punctuation">[</span>dd<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> file.<span class="token punctuation">{</span>zip,jar,apk<span class="token punctuation">}</span> file1 <span class="token punctuation">[</span>file2 <span class="token punctuation">..</span>.<span class="token punctuation">]</span>   Add specified files to Zip-compatible archive. aapt c<span class="token punctuation">[</span>runch<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> -S resource-sources <span class="token punctuation">..</span>. -C output-folder <span class="token punctuation">..</span>.   Do PNG preprocessing on one or several resource folders   and store the results <span class="token keyword">in</span> the output folder. aapt s<span class="token punctuation">[</span>ingleCrunch<span class="token punctuation">]</span> <span class="token punctuation">[</span>-v<span class="token punctuation">]</span> -i input-file -o outputfile   Do PNG preprocessing on a single file. aapt v<span class="token punctuation">[</span>ersion<span class="token punctuation">]</span>   Print program version.</code></pre><p>为了便于实验，我们新建一个 Android Demo 工程，并生成一个 demo.apk 文件待用。下面对 aapt 工具的命令一一进行实践（注意！！！输出太长的地方加了省略符号）。</p><h3 id="命令-v-ersion"><a href="#命令-v-ersion" class="headerlink" title="命令 v[ersion]"></a>命令 v[ersion]</h3><p>打印aapt的版本号：</p><pre class=" language-bash"><code class="language-bash">➜ ~ aapt <span class="token function">v</span>Android Asset Packaging Tool, v0.2-5016651</code></pre><p>瞟了一眼aapt的源码，发现它的这些命令，只要第一个字符对得上就OJBK了，不信你看：</p><pre class=" language-bash"><code class="language-bash">➜  ~ aapt vOJBKAndroid Asset Packaging Tool, v0.2-5016651</code></pre><h3 id="命令-l-ist"><a href="#命令-l-ist" class="headerlink" title="命令 l[ist]"></a>命令 l[ist]</h3><p>查看兼容 ZIP 格式归档文件的内容，可选的命令参数如下表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-v</td><td style="text-align:left">列出归档文件内容的详细信息，类似’unzip -l -v’</td></tr><tr><td style="text-align:left">-a</td><td style="text-align:left">列出apk文件的资源索引表以及Android manifest的详细内容</td></tr></tbody></table><p><br>我们使用上面生成的 demo.apk 来查看命令执行结果：</p><pre class=" language-bash"><code class="language-bash">➜ aapt l app/build/outputs/apk/debug/demo.apk AndroidManifest.xmlMETA-INF/CERT.RSAMETA-INF/CERT.SFMETA-INF/MANIFEST.MFassets/assets.txtclasses.dexres/drawable-anydpi-v21/ic_launcher_background.xmlres/drawable-xxxhdpi-v4/ic_launcher_background.pngres/layout/activity_main.xmlres/mipmap-hdpi-v4/ic_launcher.png<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>res/raw/raw.txtresources.arsc</code></pre><p>带-v参数：</p><pre class=" language-bash"><code class="language-bash">➜ aapt l -v app/build/outputs/apk/debug/demo.apkArchive:  app/build/outputs/apk/debug/demo.apk Length   Method    Size  Ratio   Offset      Date  Time  CRC-32    Name--------  ------  ------- -----  -------      ----  ----  ------    ----    2096  Deflate     772  63%    121428  11-30-79 00:00  ffffffffdf4f467e  AndroidManifest.xml     773  Deflate     603  22%    195990  11-30-79 00:00  09bb8857  META-INF/CERT.RSA    2006  Deflate     957  52%    194987  11-30-79 00:00  ffffffff89d38cd0  META-INF/CERT.SF    1969  Deflate     938  52%    193999  11-30-79 00:00  fffffffff46ceacc  META-INF/MANIFEST.MF      16  Stored       16   0%    112384  11-30-79 00:00  ffffffffe2d2eeaf  assets/assets.txt  231704  Deflate  112343  52%         0  11-30-79 00:00  ffffffff8149f570  classes.dex    5696  Deflate     982  83%    122249  11-30-79 00:00  0c9d0923  res/drawable-anydpi-v21/ic_launcher_background.xml    4708  Stored     4708   0%    160564  11-30-79 00:00  ffffffffc0e2b4a8  res/drawable-xxxhdpi-v4/ic_launcher_background.png     876  Deflate     389  56%    112525  11-30-79 00:00  029eb45b  res/layout/activity_main.xml    2963  Stored     2963   0%    133287  11-30-79 00:00  78bc849d  res/mipmap-hdpi-v4/ic_launcher.png    4905  Stored     4905   0%    125444  11-30-79 00:00  ffffffffac8a9f01  res/mipmap-hdpi-v4/ic_launcher_round.png<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>      17  Stored       17   0%    112456  11-30-79 00:00  fffffffffd969fde  res/raw/raw.txt    8412  Stored     8412   0%    112972  11-30-79 00:00  ffffffffeb638dbe  resources.arsc--------          -------  ---                            -------  323429           195293  40%                            21 files</code></pre><p>带-a参数：</p><pre class=" language-bas"><code class="language-bas">➜ aapt l -a app/build/outputs/apk/debug/demo.apkAndroidManifest.xmlMETA-INF/CERT.RSAMETA-INF/CERT.SFMETA-INF/MANIFEST.MFassets/assets.txtclasses.dexres/drawable-anydpi-v21/ic_launcher_background.xmlres/drawable-xxxhdpi-v4/ic_launcher_background.png......res/raw/raw.txtresources.arscResource table:Package Groups (1)Package Group 0 id=0x7f packageCount=1 name=cn.thismj.demo  Package 0 id=0x7f name=cn.thismj.demo    type 0 configCount=1 entryCount=57      spec resource 0x7f010000 cn.thismj.demo:attr/barrierAllowsGoneWidgets: flags=0x00000000      spec resource 0x7f010001 cn.thismj.demo:attr/barrierDirection: flags=0x00000000      ......      spec resource 0x7f010038 cn.thismj.demo:attr/layout_optimizationLevel: flags=0x00000000      config (default):        resource 0x7f010000 cn.thismj.demo:attr/barrierAllowsGoneWidgets: <bag>        resource 0x7f010001 cn.thismj.demo:attr/barrierDirection: <bag>        ......        resource 0x7f010037 cn.thismj.demo:attr/layout_goneMarginTop: <bag>        resource 0x7f010038 cn.thismj.demo:attr/layout_optimizationLevel: <bag>    ......    type 2 configCount=2 entryCount=1      spec resource 0x7f030000 cn.thismj.demo:drawable/ic_launcher_background: flags=0x00000500      config xxxhdpi:        resource 0x7f030000 cn.thismj.demo:drawable/ic_launcher_background: t=0x03 d=0x00000002 (s=0x0008 r=0x00)      config anydpi-v21:        resource 0x7f030000 cn.thismj.demo:drawable/ic_launcher_background: t=0x03 d=0x00000001 (s=0x0008 r=0x00)    ......    type 8 configCount=1 entryCount=1      spec resource 0x7f090000 cn.thismj.demo:style/AppTheme: flags=0x00000000      config (default):        resource 0x7f090000 cn.thismj.demo:style/AppTheme: <bag>Android manifest:N: android=http://schemas.android.com/apk/res/android  E: manifest (line=2)    A: android:versionCode(0x0101021b)=(type 0x10)0x1    A: android:versionName(0x0101021c)="1.0" (Raw: "1.0")    ......    E: uses-sdk (line=7)      A: android:minSdkVersion(0x0101020c)=(type 0x10)0x13      A: android:targetSdkVersion(0x01010270)=(type 0x10)0x1c    E: application (line=11)      A: android:theme(0x01010000)=@0x7f090000      A: android:label(0x01010001)=@0x7f080000      ......      A: android:roundIcon(0x0101052c)=@0x7f060001      E: activity (line=20)        A: android:name(0x01010003)="cn.thismj.demo.MainActivity" (Raw: "cn.thismj.demo.MainActivity")        E: intent-filter (line=21)          E: action (line=22)            A: android:name(0x01010003)="android.intent.action.MAIN" (Raw: "android.intent.action.MAIN")          E: category (line=24)            A: android:name(0x01010003)="android.intent.category.LAUNCHER" (Raw: "android.intent.category.LAUNCHER")</code></pre><h3 id="命令-d-ump"><a href="#命令-d-ump" class="headerlink" title="命令 d[ump]"></a>命令 d[ump]</h3><p>指定不同的子命令dump出对应的内容，如下表：</p><table><thead><tr><th style="text-align:left">子命令</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">strings</td><td style="text-align:left">列出apk中资源表的字符串池</td></tr><tr><td style="text-align:left">badging</td><td style="text-align:left">列出apk中清单文件声明的属性标签跟应用图标</td></tr><tr><td style="text-align:left">permissions</td><td style="text-align:left">列出apk清单文件声明的权限</td></tr><tr><td style="text-align:left">resources</td><td style="text-align:left">列出apk文件的资源索引表</td></tr><tr><td style="text-align:left">configurations</td><td style="text-align:left">列出apk资源声明的所有配置</td></tr><tr><td style="text-align:left">xmltree</td><td style="text-align:left">解析并打印指定被编译的二进制xml文件的元素</td></tr><tr><td style="text-align:left">xmlstrings</td><td style="text-align:left">解析并打印指定被编译的二进制xml文件的字符串池</td></tr></tbody></table><h4 id="strings"><a href="#strings" class="headerlink" title="strings"></a>strings</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d strings app/build/outputs/apk/debug/demo.apkString pool of 15 unique UTF-8 non-sorted strings, 15 entries and 0 styles using 664 bytes:String <span class="token comment" spellcheck="true">#0: Demo</span>String <span class="token comment" spellcheck="true">#1: res/drawable-anydpi-v21/ic_launcher_background.xml</span>String <span class="token comment" spellcheck="true">#2: res/drawable-xxxhdpi-v4/ic_launcher_background.png</span>String <span class="token comment" spellcheck="true">#3: res/layout/activity_main.xml</span>String <span class="token comment" spellcheck="true">#4: res/mipmap-hdpi-v4/ic_launcher.png</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>String <span class="token comment" spellcheck="true">#12: res/mipmap-xxxhdpi-v4/ic_launcher.png</span>String <span class="token comment" spellcheck="true">#13: res/mipmap-xxxhdpi-v4/ic_launcher_round.png</span>String <span class="token comment" spellcheck="true">#14: res/raw/raw.txt</span></code></pre><h4 id="badging"><a href="#badging" class="headerlink" title="badging"></a>badging</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d badging app/build/outputs/apk/debug/demo.apkpackage: name<span class="token operator">=</span><span class="token string">'cn.thismj.demo'</span> versionCode<span class="token operator">=</span><span class="token string">'1'</span> versionName<span class="token operator">=</span><span class="token string">'1.0'</span> compileSdkVersion<span class="token operator">=</span><span class="token string">'28'</span> compileSdkVersionCodename<span class="token operator">=</span><span class="token string">'9'</span>sdkVersion:<span class="token string">'19'</span>targetSdkVersion:<span class="token string">'28'</span>uses-permission: name<span class="token operator">=</span><span class="token string">'android.permission.WRITE_EXTERNAL_STORAGE'</span>uses-permission: name<span class="token operator">=</span><span class="token string">'android.permission.INTERNET'</span>application-label:<span class="token string">'Demo'</span>application-icon-160:<span class="token string">'res/mipmap-mdpi-v4/ic_launcher.png'</span>application-icon-240:<span class="token string">'res/mipmap-hdpi-v4/ic_launcher.png'</span>application-icon-320:<span class="token string">'res/mipmap-xhdpi-v4/ic_launcher.png'</span>application-icon-480:<span class="token string">'res/mipmap-xxhdpi-v4/ic_launcher.png'</span>application-icon-640:<span class="token string">'res/mipmap-xxxhdpi-v4/ic_launcher.png'</span>application-icon-65534:<span class="token string">'res/mipmap-mdpi-v4/ic_launcher.png'</span>application: label<span class="token operator">=</span><span class="token string">'Demo'</span> icon<span class="token operator">=</span><span class="token string">'res/mipmap-mdpi-v4/ic_launcher.png'</span>testOnly<span class="token operator">=</span><span class="token string">'-1'</span>application-debuggablelaunchable-activity: name<span class="token operator">=</span><span class="token string">'cn.thismj.demo.MainActivity'</span>  label<span class="token operator">=</span><span class="token string">''</span> icon<span class="token operator">=</span><span class="token string">''</span>uses-permission: name<span class="token operator">=</span><span class="token string">'android.permission.READ_EXTERNAL_STORAGE'</span>uses-implied-permission: name<span class="token operator">=</span><span class="token string">'android.permission.READ_EXTERNAL_STORAGE'</span> reason<span class="token operator">=</span><span class="token string">'requested WRITE_EXTERNAL_STORAGE'</span>feature-group: label<span class="token operator">=</span><span class="token string">''</span>  uses-feature: name<span class="token operator">=</span><span class="token string">'android.hardware.faketouch'</span>  uses-implied-feature: name<span class="token operator">=</span><span class="token string">'android.hardware.faketouch'</span> reason<span class="token operator">=</span><span class="token string">'default feature for all apps'</span>mainsupports-screens: <span class="token string">'small'</span> <span class="token string">'normal'</span> <span class="token string">'large'</span> <span class="token string">'xlarge'</span>supports-any-density: <span class="token string">'true'</span>locales: <span class="token string">'--_--'</span>densities: <span class="token string">'160'</span> <span class="token string">'240'</span> <span class="token string">'320'</span> <span class="token string">'480'</span> <span class="token string">'640'</span> <span class="token string">'65534'</span></code></pre><h4 id="permissions"><a href="#permissions" class="headerlink" title="permissions"></a>permissions</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d permissions app/build/outputs/apk/debug/demo.apkpackage: cn.thismj.demouses-permission: name<span class="token operator">=</span><span class="token string">'android.permission.WRITE_EXTERNAL_STORAGE'</span>uses-permission: name<span class="token operator">=</span><span class="token string">'android.permission.INTERNET'</span></code></pre><h4 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d resources app/build/outputs/apk/debug/demo.apkPackage Groups <span class="token punctuation">(</span>1<span class="token punctuation">)</span>Package Group 0 id<span class="token operator">=</span>0x7f packageCount<span class="token operator">=</span>1 name<span class="token operator">=</span>cn.thismj.demo  Package 0 id<span class="token operator">=</span>0x7f name<span class="token operator">=</span>cn.thismj.demo    <span class="token function">type</span> 0 configCount<span class="token operator">=</span>1 entryCount<span class="token operator">=</span>57      spec resource 0x7f010000 cn.thismj.demo:attr/barrierAllowsGoneWidgets: flags<span class="token operator">=</span>0x00000000       <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>      spec resource 0x7f010038 cn.thismj.demo:attr/layout_optimizationLevel: flags<span class="token operator">=</span>0x00000000      config <span class="token punctuation">(</span>default<span class="token punctuation">)</span>:        resource 0x7f010000 cn.thismj.demo:attr/barrierAllowsGoneWidgets: <span class="token operator">&lt;</span>bag<span class="token operator">></span>        <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>        resource 0x7f010038 cn.thismj.demo:attr/layout_optimizationLevel: <span class="token operator">&lt;</span>bag<span class="token operator">></span>    <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>    <span class="token function">type</span> 8 configCount<span class="token operator">=</span>1 entryCount<span class="token operator">=</span>1      spec resource 0x7f090000 cn.thismj.demo:style/AppTheme: flags<span class="token operator">=</span>0x00000000      config <span class="token punctuation">(</span>default<span class="token punctuation">)</span>:        resource 0x7f090000 cn.thismj.demo:style/AppTheme: <span class="token operator">&lt;</span>bag<span class="token operator">></span></code></pre><h4 id="configurations"><a href="#configurations" class="headerlink" title="configurations"></a>configurations</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d configurations app/build/outputs/apk/debug/demo.apkmdpihdpixhdpixxhdpixxxhdpianydpi-v21</code></pre><h4 id="xmltree"><a href="#xmltree" class="headerlink" title="xmltree"></a>xmltree</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d xmltree app/build/outputs/apk/debug/demo.apk res/layout/activity_main.xmlN: android<span class="token operator">=</span>http://schemas.android.com/apk/res/android  N: app<span class="token operator">=</span>http://schemas.android.com/apk/res-auto    E: android.support.constraint.ConstraintLayout <span class="token punctuation">(</span>line<span class="token operator">=</span>2<span class="token punctuation">)</span>      A: android:layout_width<span class="token punctuation">(</span>0x010100f4<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0xffffffff      A: android:layout_height<span class="token punctuation">(</span>0x010100f5<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0xffffffff      E: TextView <span class="token punctuation">(</span>line<span class="token operator">=</span>9<span class="token punctuation">)</span>        A: android:layout_width<span class="token punctuation">(</span>0x010100f4<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0xfffffffe        A: android:layout_height<span class="token punctuation">(</span>0x010100f5<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0xfffffffe        A: android:text<span class="token punctuation">(</span>0x0101014f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"Hello World!"</span> <span class="token punctuation">(</span>Raw: <span class="token string">"Hello World!"</span><span class="token punctuation">)</span>        A: app:layout_constraintBottom_toBottomOf<span class="token punctuation">(</span>0x7f01000c<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0x0        A: app:layout_constraintLeft_toLeftOf<span class="token punctuation">(</span>0x7f01001f<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0x0        A: app:layout_constraintRight_toRightOf<span class="token punctuation">(</span>0x7f010023<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0x0        A: app:layout_constraintTop_toTopOf<span class="token punctuation">(</span>0x7f010028<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">(</span>type 0x10<span class="token punctuation">)</span>0x0</code></pre><h4 id="xmlstrings"><a href="#xmlstrings" class="headerlink" title="xmlstrings"></a>xmlstrings</h4><pre class=" language-bash"><code class="language-bash">➜ aapt d xmlstrings app/build/outputs/apk/debug/demo.apk res/layout/activity_main.xmlString pool of 14 unique UTF-8 non-sorted strings, 14 entries and 0 styles using 436 bytes:String <span class="token comment" spellcheck="true">#0: layout_width</span>String <span class="token comment" spellcheck="true">#1: layout_height</span>String <span class="token comment" spellcheck="true">#2: text</span>String <span class="token comment" spellcheck="true">#3: layout_constraintBottom_toBottomOf</span>String <span class="token comment" spellcheck="true">#4: layout_constraintLeft_toLeftOf</span>String <span class="token comment" spellcheck="true">#5: layout_constraintRight_toRightOf</span>String <span class="token comment" spellcheck="true">#6: layout_constraintTop_toTopOf</span>String <span class="token comment" spellcheck="true">#7: Hello World!</span>String <span class="token comment" spellcheck="true">#8: TextView</span>String <span class="token comment" spellcheck="true">#9: android</span>String <span class="token comment" spellcheck="true">#10: android.support.constraint.ConstraintLayout</span>String <span class="token comment" spellcheck="true">#11: app</span>String <span class="token comment" spellcheck="true">#12: http://schemas.android.com/apk/res-auto</span>String <span class="token comment" spellcheck="true">#13: http://schemas.android.com/apk/res/android</span></code></pre><h3 id="命令-p-ackage"><a href="#命令-p-ackage" class="headerlink" title="命令 p[ackage]"></a>命令 p[ackage]</h3><p>Android项目的构建流程就是用这个命令来编译和打包资源文件的，这个命令比较复杂，可选参数也非常多，我们列举一些比较重要的参数如下表：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-v</td><td style="text-align:left">输出详细信息（通过详细信息可以粗略分析aapt打包的流程）</td></tr><tr><td style="text-align:left">-f</td><td style="text-align:left">强制覆盖已经存在的文件</td></tr><tr><td style="text-align:left">-M</td><td style="text-align:left">指定AndroidManifest文件的完整路径</td></tr><tr><td style="text-align:left">-I</td><td style="text-align:left">添加已经存在的资源包（一般是对应平台的系统资源包，可以添加多个）</td></tr><tr><td style="text-align:left">-A</td><td style="text-align:left">指定assets资源目录</td></tr><tr><td style="text-align:left">-S</td><td style="text-align:left">指定res资源目录（可以多个，从左到右优先级递减）</td></tr><tr><td style="text-align:left">-J</td><td style="text-align:left">指定生成R.java的目录</td></tr><tr><td style="text-align:left">-m</td><td style="text-align:left">在-J指定的目录下增加包名对应的目录</td></tr><tr><td style="text-align:left">-F</td><td style="text-align:left">指定生成资源包的路径（ZIP格式兼容文件）</td></tr><tr><td style="text-align:left">–max-res-version</td><td style="text-align:left">如果指定为19，则类似drawable-v21的资源文件夹会被忽略</td></tr></tbody></table><p>一般来说，一个Android项目会依赖很多Module和第三方库，这些依赖库也会包含自己的资源文件，所以在进行编译和打包资源文件之前，首先需要对资源进行合并。例如，对上面的Demo工程而言，如果我们想打一个debug的版本，那么Android Studio的Gradle插件在编译打包资源文件之前会先把所有资源合并到如下目录：</p><pre class=" language-bash"><code class="language-bash">//resapp<span class="token punctuation">(</span>主工程<span class="token punctuation">)</span>/build/intermediates/res/merged/debug  //AndroidManifest文件app<span class="token punctuation">(</span>主工程<span class="token punctuation">)</span>/build/intermediates/manifests/full/debug/AndroidManifest.xml</code></pre><p>p命令比较复杂，我们可以用Demo工程来做一个简单的试验，首先尝试用p命令生成R.java文件：</p><pre class=" language-bash"><code class="language-bash">➜ aapt p \-M app/build/intermediates/manifests/full/debug/AndroidManifest.xml \-I ~/Library/Android/sdk/platforms/android-28/android.jar \-A app/src/main/assets \-S app/build/intermediates/res/merged/debug/ \-J output \-m \-f</code></pre><p>此时查看Demo工程目录output文件夹下生成的文件：</p><pre class=" language-bash"><code class="language-bash">➜ tree output output└── cn    └── thismj        └── demo            └── R.java3 directories, 1 <span class="token function">file</span></code></pre><p>继续用p命令编译打包生成资源包文件：</p><pre class=" language-bash"><code class="language-bash">➜ aapt p \-M app/build/intermediates/manifests/full/debug/AndroidManifest.xml \-I ~/Library/Android/sdk/platforms/android-28/android.jar \-A app/src/main/assets \-S app/build/intermediates/res/merged/debug/ \-F output/resource-debug.ap_ \-f</code></pre><p>再次查看output文件夹：</p><pre class=" language-bash"><code class="language-bash">➜ tree outputoutput├── cn│   └── thismj│       └── demo│           └── R.java└── resource-debug.ap_3 directories, 2 files</code></pre><p>我们把生成的资源文件包resource-debug.ap_解压，查看里面的文件结构：</p><pre class=" language-bash"><code class="language-bash">➜  resource-debug tree<span class="token keyword">.</span>├── AndroidManifest.xml├── assets│   └── assets.txt├── res│   ├── drawable-anydpi-v21│   │   └── ic_launcher_background.xml│   ├── drawable-hdpi-v4│   │   └── ic_launcher_background.png│   ├── drawable-ldpi-v4│   │   └── ic_launcher_background.png│   ├── drawable-mdpi-v4│   │   └── ic_launcher_background.png│   ├── drawable-xhdpi-v4│   │   └── ic_launcher_background.png│   ├── drawable-xxhdpi-v4│   │   └── ic_launcher_background.png│   ├── drawable-xxxhdpi-v4│   │   └── ic_launcher_background.png│   ├── layout│   │   └── activity_main.xml│   ├── mipmap-hdpi-v4│   │   ├── ic_launcher.png│   │   └── ic_launcher_round.png│   ├── mipmap-mdpi-v4│   │   ├── ic_launcher.png│   │   └── ic_launcher_round.png│   ├── mipmap-xhdpi-v4│   │   ├── ic_launcher.png│   │   └── ic_launcher_round.png│   ├── mipmap-xxhdpi-v4│   │   ├── ic_launcher.png│   │   └── ic_launcher_round.png│   ├── mipmap-xxxhdpi-v4│   │   ├── ic_launcher.png│   │   └── ic_launcher_round.png│   └── raw│       └── raw.txt└── resources.arsc16 directories, 22 files</code></pre><h3 id="命令-r-emove"><a href="#命令-r-emove" class="headerlink" title="命令 r[emove]"></a>命令 r[emove]</h3><p>删除（.zip、.jar、.apk等）里面指定的文件，可选参数：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-v</td><td style="text-align:left">输出详细信息（好像没什么用）</td></tr></tbody></table><p>删除上述p命令生成的资源包（resource-debug.ap_）中的某些文件：</p><pre class=" language-bash"><code class="language-bash">➜ aapt r -v output/resource-debug.ap_ res/layout/activity_main.xml AndroidManifest.xml </code></pre><h3 id="命令-a-dd"><a href="#命令-a-dd" class="headerlink" title="命令 a[dd]"></a>命令 a[dd]</h3><p>添加文件到（.zip、.jar、.apk等），可选参数：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-v</td><td style="text-align:left">输出详细信息（没什么用）</td></tr></tbody></table><p>添加一些文件到上述p命令生成的资源包（resource-debug.ap_）中。</p><pre class=" language-bash"><code class="language-bash">➜ a apt a -v output/resource-debug.ap_ classes.dex Demo.iml  <span class="token string">'classes.dex'</span><span class="token punctuation">..</span>. <span class="token string">'Demo.iml'</span><span class="token punctuation">..</span>.</code></pre><h3 id="命令-c-runch"><a href="#命令-c-runch" class="headerlink" title="命令 c[runch]"></a>命令 c[runch]</h3><p>对一个或多个资源文件夹下的PNG图片进行预处理（内部使用libpng库来解析PNG文件，用zlib库压缩生成新图片），该命令需要指定参数如下：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-S</td><td style="text-align:left">指定源文件夹</td></tr><tr><td style="text-align:left">-C</td><td style="text-align:left">指定源文件预处理完成之后保存的文件夹</td></tr></tbody></table><p>在Mac系统下随便截了一张图，放在Demo工程的png目录，然后尝试用AAPT进行预处理，结果保存在Demo工程的output/result目录，结果如下：</p><pre class=" language-bash"><code class="language-bash">➜ aapt c -v -S png -C output/resultCrunching PNG Files <span class="token keyword">in</span> <span class="token function">source</span> dir: pngTo destination dir: output/resultProcessing image to cache: png/截图.png <span class="token operator">=</span><span class="token operator">></span> output/result/截图.png  <span class="token punctuation">(</span>processed image to cache entry output/result/截图.png: 67% size of source<span class="token punctuation">)</span>Crunched 1 PNG files to update cache</code></pre><h3 id="命令-s-ingleCrunch"><a href="#命令-s-ingleCrunch" class="headerlink" title="命令 s[ingleCrunch]"></a>命令 s[ingleCrunch]</h3><p>仅仅对单张PNG图片进行预处理，该命令需要指定参数如下：</p><table><thead><tr><th style="text-align:left">参数</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left">-i</td><td style="text-align:left">PNG源文件路径</td></tr><tr><td style="text-align:left">-o</td><td style="text-align:left">PNG源文件预处理完成之后保存的路径</td></tr></tbody></table><p>把刚才的截图用s命令再处理一遍：</p><pre class=" language-bash"><code class="language-bash">➜ aapt s -v -i png/截图.png -o output/result.pngCrunching single PNG file: png/截图.png    Output file: output/result.pngProcessing image to cache: png/截图.png <span class="token operator">=</span><span class="token operator">></span> output/result.png  <span class="token punctuation">(</span>processed image to cache entry output/result.png: 67% size of source<span class="token punctuation">)</span></code></pre><p>又去瞟了一眼源码，发现还有这么个奇淫巧技：</p><pre class=" language-bash"><code class="language-bash">➜ aapt mReadyspng/截图.pngoutput/xx.png      Crunching png/截图.pngCrunching single PNG file: png/截图.png    Output file: oxx.pngDonequit</code></pre><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过以上的实践，算是对 AAPT 有了一个初步的了解，知道了 AAPT 在整个 Android 项目构建流程中的主要职责。实际上，在 Android Gradle Plugin 3.0.0以上版本，已经默认使用 <a href="https://developer.android.com/studio/command-line/aapt2" target="_blank" rel="noopener">AAPT2</a> 了，AAPT2 为资源的增量编译提供了支持……</p><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://elinux.org/Android_aapt" target="_blank" rel="noopener">Android aapt</a></li><li><a href="https://cloud.tencent.com/developer/article/1004331" target="_blank" rel="noopener">关于Android图片资源瘦身的奇思妙想</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AAPT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅析ZIP格式</title>
      <link href="/2019/02/14/qian-xi-zip-ge-shi/"/>
      <url>/2019/02/14/qian-xi-zip-ge-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ZIP文件格式是一种数据压缩和文档储存的文件格式，原名Deflate，发明者为菲尔·卡茨（Phil Katz），他于1989年1月公布了该格式的资料。ZIP通常使用后缀名“.zip”，它的MIME格式为application/zip。</p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为什么要了解ZIP格式？因为apk格式实际上也遵循<a href="https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.2.0.txt" target="_blank" rel="noopener">ZIP标准</a>，如果要研究apk打包、签名等流程，那么最好先对ZIP格式有个简单的了解。</p><h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><p>一个ZIP压缩文件的通用格式如下：</p><pre><code>Overall .ZIP file format:    [local file header 1]    [file data 1]    [data descriptor 1]    .     .    .    [local file header n]    [file data n]    [data descriptor n]    [archive decryption header] (EFS)    [archive extra data record] (EFS)    [central directory]    [zip64 end of central directory record]    [zip64 end of central directory locator]     [end of central directory record]</code></pre><p>对其中主要的数据段分析如下：</p><h3 id="Local-file-header-文件头"><a href="#Local-file-header-文件头" class="headerlink" title="Local file header 文件头"></a>Local file header 文件头</h3><table><thead><tr><th>Offset</th><th>Bytes</th><th>Description</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>4</td><td>local file header signature</td><td>文件头标识 (固定值0x04034b50)</td></tr><tr><td>4</td><td>2</td><td>version needed to extract</td><td>解压时遵循ZIP规范的最低版本</td></tr><tr><td>6</td><td>2</td><td>general purpose bit flag</td><td>通用标志位</td></tr><tr><td>8</td><td>2</td><td>compression method</td><td>压缩方式</td></tr><tr><td>10</td><td>2</td><td>last mod file time</td><td>最后修改时间（MS-DOS格式）</td></tr><tr><td>12</td><td>2</td><td>last mod file date</td><td>最后修改日期（MS-DOS格式）</td></tr><tr><td>14</td><td>4</td><td>crc-32</td><td>冗余校验码</td></tr><tr><td>18</td><td>4</td><td>compressed size</td><td>压缩后的大小</td></tr><tr><td>22</td><td>4</td><td>uncompressed size</td><td>未压缩之前的大小</td></tr><tr><td>26</td><td>2</td><td>file name length</td><td>文件名长度（n）</td></tr><tr><td>28</td><td>2</td><td>extra field length</td><td>扩展区长度（m）</td></tr><tr><td>30</td><td>n</td><td>file name</td><td>文件名</td></tr><tr><td>30+n</td><td>m</td><td>extra field</td><td>扩展区</td></tr></tbody></table><p><br></p><h3 id="File-data-文件数据"><a href="#File-data-文件数据" class="headerlink" title="File data 文件数据"></a>File data 文件数据</h3><p>储存在[Local file header] 数据段后，用来记录文件本身的数据。</p><h3 id="Data-descriptor-数据描述"><a href="#Data-descriptor-数据描述" class="headerlink" title="Data descriptor 数据描述"></a>Data descriptor 数据描述</h3><table><thead><tr><th>Offset</th><th>Bytes</th><th>Description</th><th>译</th></tr></thead><tbody><tr><td>0</td><td>4</td><td></td><td>数据描述符标识（固定值0x08074b50，<a href="https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.2.0.txt" target="_blank" rel="noopener">ZIP标准</a>里面没有这个字段）</td></tr><tr><td>4</td><td>4</td><td>crc-32</td><td>冗余校验码</td></tr><tr><td>8</td><td>4</td><td>compressed size</td><td>压缩后的大小</td></tr><tr><td>12</td><td>4</td><td>uncompressed size</td><td>未压缩之前的大小</td></tr></tbody></table><p>只有当 [local file header] 的 <em>general purpose bit flag</em> 字段第3位Bit置1时，[data descriptor] 才会存在，此时[local file header] 的 <em>crc-32</em> 、<em>compressed size</em> 、<em>uncompressed size</em> 这三个字段都会被储存为0，其正确的值会记录在 [data descriptor] 数据段里面。</p><h3 id="Central-directory"><a href="#Central-directory" class="headerlink" title="Central directory"></a>Central directory</h3><p>根据上面的分析可知，ZIP中的每一个文件，都对应着 [local file header] + [file data] + [data descriptor]，而 [central directory] 就是ZIP中所有文件的目录，其储存格式展开如下：</p><pre><code>[file header 1]      .      .      . [file header n][digital signature] </code></pre><h4 id="File-header"><a href="#File-header" class="headerlink" title="File header"></a>File header</h4><table><thead><tr><th>Offset</th><th>Bytes</th><th>Description</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>4</td><td>central file header signature</td><td>文件头标识 (固定值0x02014b50)</td></tr><tr><td>4</td><td>2</td><td>version made by</td><td>高位字节表示文件属性信息的兼容性，<br>低位字节表示压缩软件支持的ZIP规范版本</td></tr><tr><td>6</td><td>2</td><td>version needed to extract</td><td>解压时遵循ZIP规范的最低版本</td></tr><tr><td>8</td><td>2</td><td>general purpose bit flag</td><td>通用标志位</td></tr><tr><td>10</td><td>2</td><td>compression method</td><td>压缩方式</td></tr><tr><td>12</td><td>2</td><td>last mod file time</td><td>最后修改时间（MS-DOS格式）</td></tr><tr><td>14</td><td>2</td><td>last mod file date</td><td>最后修改日期（MS-DOS格式）</td></tr><tr><td>16</td><td>4</td><td>crc-32</td><td>冗余校验码</td></tr><tr><td>20</td><td>4</td><td>compressed size</td><td>压缩后的大小</td></tr><tr><td>24</td><td>4</td><td>uncompressed size</td><td>未压缩之前的大小</td></tr><tr><td>28</td><td>2</td><td>file name length</td><td>文件名长度（n）</td></tr><tr><td>30</td><td>2</td><td>extra field length</td><td>扩展区长度（m）</td></tr><tr><td>32</td><td>2</td><td>file comment length</td><td>文件注释长度（k）</td></tr><tr><td>34</td><td>2</td><td>disk number start</td><td>文件开始位置的磁盘编号</td></tr><tr><td>36</td><td>2</td><td>internal file attributes</td><td>内部文件属性</td></tr><tr><td>38</td><td>4</td><td>external file attributes</td><td>外部文件属性</td></tr><tr><td>42</td><td>4</td><td>relative offset of local header</td><td>对应 [local file header] 的偏移位置</td></tr><tr><td>46</td><td>n</td><td>file name</td><td>目录文件名</td></tr><tr><td>46+n</td><td>m</td><td>extra field</td><td>扩展域</td></tr><tr><td>46+n+m</td><td>k</td><td>file comment</td><td>文件注释内容</td></tr></tbody></table><p><br></p><h4 id="digital-signature"><a href="#digital-signature" class="headerlink" title="digital signature"></a>digital signature</h4><table><thead><tr><th>Offset</th><th>Bytes</th><th>Description</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>4</td><td>header signature</td><td>数字签名头标识 (固定值0x05054b50)</td></tr><tr><td>4</td><td>2</td><td>size of data</td><td>数字签名数据大小（n）</td></tr><tr><td>6</td><td>n</td><td>signature data</td><td>数字签名数据</td></tr></tbody></table><p><br></p><h3 id="end-of-central-directory-record-中心目录结束记录"><a href="#end-of-central-directory-record-中心目录结束记录" class="headerlink" title="end of central directory record 中心目录结束记录"></a>end of central directory record 中心目录结束记录</h3><table><thead><tr><th>Offset</th><th>Bytes</th><th>Description</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>4</td><td>end of central dir signature</td><td>中心目录结束标识 (固定值0x06054b50)</td></tr><tr><td>4</td><td>2</td><td>number of this disk</td><td>当前磁盘编号</td></tr><tr><td>6</td><td>2</td><td>number of the disk with the<br>start of the central directory</td><td>中心目录开始位置的磁盘编号</td></tr><tr><td>8</td><td>2</td><td>total number of entries in the<br>central directory on this disk</td><td>中心目录开始位置的磁盘编号</td></tr><tr><td>10</td><td>2</td><td>total number of entries in<br>the central directory</td><td>该磁盘上所记录的中心目录数量</td></tr><tr><td>12</td><td>4</td><td>size of the central directory</td><td>中心目录大小</td></tr><tr><td>16</td><td>4</td><td>offset of start of central<br>directory with respect to<br>the starting disk number</td><td>中心目录开始位置相对于.ZIP archive开始的位移</td></tr><tr><td>20</td><td>2</td><td>.ZIP file comment length</td><td>ZIP文件注释内容长度（n）</td></tr><tr><td>22</td><td>n</td><td>.ZIP file comment</td><td>ZIP文件注释内容</td></tr></tbody></table><p><br><br>根据以上的分析，可以知道一个ZIP压缩文件，主要包含三个部分，即：</p><p><img src="https://thismj.nos-eastchina1.126.net/image/zip_format.png" alt="Alt text"></p><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><p>我们在Mac OS下打包一个ZIP文件，来与上面的分析做一个对比，文件目录如下所示：</p><pre><code>.├── a.txt└── b    └── c.txt1 directory, 2 files</code></pre><p>用Sublime打开ZIP压缩文件：</p><pre><code>504b 0304 1400 0800 0800 0588 4d4e 0000 0000 0000 0000 0000 0000 0500 1000 612e7478 7455 580c 009b dc63 5c9a dc63 5c573c14 002b c9c8 2c56 00a2 b4a2 fc5c 85443d00 504b 0708 3098 2c41 0f00 0000 0f000000 504b 0304 0a00 0000 0000 0d88 4d4e0000 0000 0000 0000 0000 0000 0900 10005f5f 4d41 434f 5358 2f55 580c 00aa dc635caa dc63 5c57 3cec 8250 4b03 0414 00080008 0005 884d 4e00 0000 0000 0000 00000000 0010 0010 005f 5f4d 4143 4f53 582f2e5f 612e 7478 7455 580c 009b dc63 5c9adc63 5c57 3c14 0063 6015 6367 6062 60f04d4c 56f0 0f56 8850 8002 9018 0327 101b3130 30c6 0169 209f 7102 0351 c031 242408c2 02e9 60e4 0032 3ad0 9430 43c5 f91918c4 93f3 73f5 120b 0a72 52f5 4252 2b4a5cf3 92f3 5332 f3d2 21fa c581 8400 03831442 4d4e 6271 4969 716a 4a4a 6249 aa724030 d41e 7520 91c9 c060 8e50 979b 5a920854 9368 95ed ebe2 9398 949a 135f 5c92959d 9897 9f98 9596 9d93 9392 9666 9e515a54 9169 6e52 5609 d45c 5a92 a66b 616d686c 6264 686e 6961 d27d 2739 0664 b0f4a373 6220 fa93 5d43 c3cb 53a6 4b57 702edaaa a4bf d8c3 2453 3022 7fff 8cf3 2d471c0f 9d12 3a97 f329 b63a ffdc 875b 933bceed 5256 9467 555c 7791 31fb e331 8d4821e9 4bde fd11 f24e 6fa2 ea53 7ce5 19ffe8f1 9e62 292b e44a 955a ef79 8edd e74ceb96 6379 22ca e993 19ca be04 28a8 856e6bb8 0300 504b 0708 3695 1560 2d01 00009001 0000 504b 0304 0a00 0000 0000 0a884d4e 0000 0000 0000 0000 0000 0000 02001000 622f 5558 0c00 aadc 635c a3dc 635c573c 1400 504b 0304 1400 0800 0800 0a884d4e 0000 0000 0000 0000 0000 0000 07001000 622f 632e 7478 7455 580c 00a8 dc635ca3 dc63 5c57 3c14 002b c9c8 2c56 00a2b4a2 fc5c 8564 3d00 504b 0708 b2fa 1a730f00 0000 0f00 0000 504b 0304 0a00 00000000 0d88 4d4e 0000 0000 0000 0000 00000000 0b00 1000 5f5f 4d41 434f 5358 2f622f55 580c 00aa dc63 5caa dc63 5c57 3cec8250 4b03 0414 0008 0008 000a 884d 4e000000 0000 0000 0000 0000 0012 0010 005f5f4d 4143 4f53 582f 622f 2e5f 632e 74787455 580c 00a8 dc63 5ca3 dc63 5c57 3c140063 6015 6367 6062 60f0 4d4c 56f0 0f568850 8002 9018 0327 101b 01f1 4620 06f11f33 1005 1c43 4282 a04c 908e 2340 2c8fa684 092a cecf c020 9e9c 9fab 9758 509093aa 1792 5a51 e29a 979c 9f92 9997 0e517719 8805 1818 a410 6a72 128b 4b4a 8b535352 124b 5295 0382 418a 4a4b d274 2dac0d8d 4d8c 0ccd 2d2d 4ce6 dd49 8e01 09577b69 aa82 6800 504b 0708 7d78 286a 85000000 e300 0000 504b 0102 1503 1400 08000800 0588 4d4e 3098 2c41 0f00 0000 0f000000 0500 0c00 0000 0000 0000 0040 a4810000 0000 612e 7478 7455 5808 009b dc635c9a dc63 5c50 4b01 0215 030a 0000 0000000d 884d 4e00 0000 0000 0000 0000 00000009 000c 0000 0000 0000 0000 40fd 41520000 005f 5f4d 4143 4f53 582f 5558 0800aadc 635c aadc 635c 504b 0102 1503 14000800 0800 0588 4d4e 3695 1560 2d01 00009001 0000 1000 0c00 0000 0000 0000 0040a481 8900 0000 5f5f 4d41 434f 5358 2f2e5f61 2e74 7874 5558 0800 9bdc 635c 9adc635c 504b 0102 1503 0a00 0000 0000 0a884d4e 0000 0000 0000 0000 0000 0000 02000c00 0000 0000 0000 0040 ed41 0402 0000622f 5558 0800 aadc 635c a3dc 635c 504b0102 1503 1400 0800 0800 0a88 4d4e b2fa1a73 0f00 0000 0f00 0000 0700 0c00 00000000 0000 0040 a481 3402 0000 622f 632e7478 7455 5808 00a8 dc63 5ca3 dc63 5c504b01 0215 030a 0000 0000 000d 884d 4e000000 0000 0000 0000 0000 000b 000c 00000000 0000 0000 40fd 4188 0200 005f 5f4d4143 4f53 582f 622f 5558 0800 aadc 635caadc 635c 504b 0102 1503 1400 0800 08000a88 4d4e 7d78 286a 8500 0000 e300 00001200 0c00 0000 0000 0000 0040 a481 c1020000 5f5f 4d41 434f 5358 2f62 2f2e 5f632e74 7874 5558 0800 a8dc 635c a3dc 635c504b 0506 0000 0000 0700 0700 da01 00009603 0000 0000 </code></pre><p>Mac下的ZIP文件存储采用的是utf-8编码，我们根据ZIP文件的结构进行对照解析，通过固定值标识以及偏移找到对应字段的数据值，非内容字段值存储采用的是<a href="http://www.ruanyifeng.com/blog/2016/11/byte-order.html" target="_blank" rel="noopener">小端字节序</a>，下面表格列出的值都已转换成了我们能阅读的大端字节序，源文件数据储存区解析（部分字段）如下表：</p><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>version needed to extract</td><td>0x0014</td><td>20/10=2 20%10=0 最低ZIP规范版本为2.0</td></tr><tr><td>general purpose bit flag</td><td>0x0008</td><td>0000 0000 0000 1000（第3位Bit为1）</td></tr><tr><td>file name length</td><td>0x0005</td><td>文件名长度为 5 Bytes</td></tr><tr><td>file name</td><td>0x612e747874</td><td>a.txt</td></tr></tbody></table><hr><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>file name length</td><td>0x0009</td><td>文件名长度为 9 Bytes</td></tr><tr><td>file name</td><td>0x5f5f4d41434f53582f</td><td>__MACOSX/</td></tr></tbody></table><hr><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>file name length</td><td>0x0010</td><td>文件名长度为 9 Bytes</td></tr><tr><td>file name</td><td>0x5f5f4d41434f53582f2e</td><td>__MACOSX/.</td></tr></tbody></table><hr><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>file name length</td><td>0x0002</td><td>文件名长度为 2 Bytes</td></tr><tr><td>file name</td><td>0x622f</td><td>b/</td></tr></tbody></table><hr><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>file name length</td><td>0x0007</td><td>文件名长度为 7 Bytes</td></tr><tr><td>file name</td><td>0x622f632e747874</td><td>b/c.txt</td></tr></tbody></table><hr><table><thead><tr><th>字段</th><th>值</th><th>解析 </th></tr></thead><tbody><tr><td>local file header signature</td><td>0x04034b50</td><td>固定值  </td></tr><tr><td>file name length</td><td>0x000b</td><td>文件名长度为 11 Bytes</td></tr><tr><td>file name</td><td>0x5f5f4d41434f53582f622f</td><td>__MACOSX/b/</td></tr></tbody></table><p>……（还有文件，不看了，眼睛都看花了，一大堆Mac文件系统的隐藏文件也打进ZIP了）</p><p>中心目录区跟中心目录结束标识区也可以按照相同的方法进行手动解析，在此就不一一验证了。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由此，也算了解了ZIP压缩文件的基本格式，还有些问题需要探究，在此记录一下，后续有需求的话再来钻研。</p><ol><li>ZIP格式的中心目录区的意义？ 能想到的有两点，一是因为中心目录区的存在，可以在不解压文件的情况下快速列出ZIP的目录；二是中心目录区文件头的偏移值能够快速定位到对应的源文件储存区的位置。</li><li>ZIP的压缩方式？加密方式？</li><li>源文件储存区的数据是如何保证完整性的，也就是数据进行数字签名的方式等等。</li><li>[archive decryption header]、[archive extra data record]等。</li></ol><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ul><li><a href="https://pkware.cachefly.net/webdocs/APPNOTE/APPNOTE-6.2.0.txt" target="_blank" rel="noopener">ZIP官方规范文档</a></li><li><a href="https://hellohxk.com/blog/archives/" target="_blank" rel="noopener">ZIP格式解析</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/11/byte-order.html" target="_blank" rel="noopener">理解字节序</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 杂项 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ZIP </tag>
            
            <tag> 压缩 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019年初，给30岁之际的自己立些儿Flag</title>
      <link href="/2019/01/14/2019-nian-chu-gei-30-sui-zhi-ji-de-zi-ji-li-xie-er-flag/"/>
      <url>/2019/01/14/2019-nian-chu-gei-30-sui-zhi-ji-de-zi-ji-li-xie-er-flag/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前头的话"><a href="#写在前头的话" class="headerlink" title="写在前头的话"></a>写在前头的话</h2><p>一直都没有做过总结，自我认知也是比较主观，所以有的时候会比较茫然，不知道怎么去弥补自己的不足，让自己成为一个优秀的人。回想一下，毕业快四年半了，没什么值得自己骄傲的事情，反而是磨灭了年轻时的热情。因为没有一个系统的规划，抬起脚都不知道往哪里走，又或者每条路都试探一下，然后再缩回来，最终发现还是原地踏步。</p><p>现在已经是吃着30岁的饭了，18岁的照片也只能默默看看了，年龄大了，责任重了，危机感意识也该上来了，不能让自己过得太安逸了，所以自我提升已经迫在眉睫。赶在2019年初，对自己有个客观清晰的认识，规划一下自己职业发展的道路，给自己立些儿Flag。</p><h2 id="自我认知"><a href="#自我认知" class="headerlink" title="自我认知"></a>自我认知</h2><p>总体来说，各方面都谈不上优秀，中规中矩，但是能把事情做好。</p><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><ul><li><p>考虑问题全面<br>善于利用自己的知识全面地看问题，能够考虑到每个维度的事情，并争取把各个维度都做好。</p></li><li><p>独立解决问题的能力<br>碰到棘手的问题不会束手无策，比较喜欢钻研，最终让问题迎刃而解。</p></li><li><p>责任感<br>严谨地对待工作的态度，对自己交付的东西有追求，确保质量。</p></li></ul><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul><li><p>疏忽重点<br>做一件事情，能够清楚地知道重点在哪里，但是却偏爱把精力花在一些不那么重要的点上，时间分配异常不合理。比如搭建一个博客，虽然知道内容才是重点，但是却花大量的时间纠结在主题选择上面；写一段代码花了半小时，可能1/3的时间在修改某个变量的名字，仅仅只是觉得它看起来有点怪？</p></li><li><p>不善于思考<br>没有思考的习惯，对身边的事情缺乏自己的见解，当被临时问到的时候，表达不清楚。</p></li><li><p>不会盲打<br>错误的打字习惯导致，作为一个码农来说，这是不合格的。</p></li><li><p>……</p></li></ul><h3 id="不足"><a href="#不足" class="headerlink" title="不足"></a>不足</h3><ul><li>归纳总结的能力</li><li>沟通表达能力</li><li>自律性</li><li>时间管理</li></ul><h2 id="职业规划"><a href="#职业规划" class="headerlink" title="职业规划"></a>职业规划</h2><p>现阶段，硬实力方面，努力提升自己的技术，通过有效的方法持续地做好技术分享与沉淀，进而形成自己的知识体系，从以下几个方面来执行：</p><ol><li>九层之台，起于累土。在工作中发散思维，举一反三，巩固自己的基础，不断地修炼自己的内功，像数据结构、算法、网络、操作系统、设计模式等等</li><li>通过不断地钻研，来挖掘自己的技术深度，阅读源码，掌握更深层次的知识，比如性能优化、插件化、Binder机制、Java内存管理等等</li><li>持续地学习前沿技术，以此增加自己的职业竞争力</li></ol><p>增强自己的软实力，从以下几个方面入手：</p><ol><li>在工作中锻炼自己的沟通协调能力</li><li>在项目上学习如何进行把控、如何进行风险预测</li><li>首先学会管理自己，然后逐步培养管理他人的意识</li><li>培养自己的产品思维</li></ol><h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><h3 id="写博客"><a href="#写博客" class="headerlink" title="写博客"></a>写博客</h3><p>养成写博客的习惯，保持每个月3-4篇的博客更新频率，以记录或者分享技术主题为主。</p><h3 id="学习积累"><a href="#学习积累" class="headerlink" title="学习积累"></a>学习积累</h3><p>以下的知识点，目前所掌握的都是零零碎碎的，需要系统地进行学习，形成自己的知识体系：</p><ul><li>系统地学习自定义View的所有相关知识，形成自定义View的知识体系，实践仿写一些比较复杂的效果</li><li>系统地学习Android插件化所需要掌握的底层知识，掌握1-2种主流的热修复框架</li><li>系统学习Java虚拟机相关知识《深入理解Java虚拟机:JVM高级特性与实践》</li><li>复习巩固基本数据结构与算法《大话数据结构》</li><li>了解并学习计算器网络、HTTP、HTTPS、TCP/IP的一些细节，这块一直比较薄弱</li></ul><h2 id="对自己的寄语"><a href="#对自己的寄语" class="headerlink" title="对自己的寄语"></a>对自己的寄语</h2><p>自律，让生活更美好，希望在新的这一年里，自己能够距离优秀更近一些。</p>]]></content>
      
      
      <categories>
          
          <category> 总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 规划 </tag>
            
            <tag> 目标 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从需求探索ConstraintLayout</title>
      <link href="/2018/12/01/ji-zhu-constraintlayout/"/>
      <url>/2018/12/01/ji-zhu-constraintlayout/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>对于前端开发，画界面这种事情是必不可少的，并且能够直观地看到代码到视觉的转换，我觉得是一件很有意思的事情。当然，界面是由很多子元素组成的，我们需要选取不同的布局方式，把这些子元素按照设计稿的要求排列起来。首先简明扼要地概括一下Android中几种常用的布局方式：</p><ul><li>帧布局（FrameLayout）：子控件按照先后顺序叠在一起。</li><li>线性布局（LinearLayout）：子控件水平方向排成一行或者垂直方向排成一列。</li><li>相对布局（RelativeLayout）：子控件的位置相对于同层的其它子控件或者父控件排列。</li></ul><p>以上三种布局方式，在Android开发中基本算是家常便饭了，它们术业有专攻，各司其职。也正因为如此，如果碰到一个稍微复杂点的界面，需要它们相互配合，一层一层地嵌套起来。那么有没有一种布局方式能够足够灵活，使所有的子元素都能平铺开来而没有任何嵌套呢？</p><!--![](http://5b0988e595225.cdn.sohucs.com/images/20171018/6b61446f7ccf448d893b4ff1dc031f77.jpeg)--><p>ConstraintLayout，了解一下？那么，我们根据相关的需求来探索一下，约束布局到底能做什么！</p><hr><h2 id="边的相对性"><a href="#边的相对性" class="headerlink" title="边的相对性"></a>边的相对性</h2><p>首先，最基本的，两个Button A和B，A需要放在父控件的左上角，B需要放在A的右边。用约束布局来描述的话就是：在水平方向，A的左边约束在父控件的左边，A的上边约束在父控件的上边；B的左边约束在A的右边，B的上边约束在父控件的上边。听起来更复杂些，但确是合理的，因为仅仅只是某个方向的约束并不能确定一个子控件的具体位置，所以对于约束布局来说，每一个子控件必须在水平以及垂直方向至少施加一个约束条件。</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_relative_positioning_example.png" alt=""></p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>8dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>按照个人理解，RelativeLayout的定义倾向于整体，比如Button B在Button A的右边，但是ConstraintLayout更倾向于部分，比如Button B的左边约束在Button A的右边，当然，实际上原理跟结果是一样的。</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_relative_positioning.png" alt=""></p><hr><h2 id="如何居中"><a href="#如何居中" class="headerlink" title="如何居中"></a>如何居中</h2><p>相对定位是有了，那么如何让子控件居中呢？这种需求基本算是家常便饭了。我们知道，不管是帧布局、线性布局还是相对布局，都有layout_gravity的属性，但是约束布局是没有直接属性可以让一个控件居中的，它以一种更加通用的方式来实现居中，看看代码就清楚了：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_mediate.png" alt=""></p><p>为什么说这种方式更通用，因为layout_gravity只能相对于父控件居中，而约束布局居中的方式，可以让一个控件相对于其它任何控件居中，并且不会有布局嵌套的情况。如下图所示：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_mediate_2.png" alt=""></p><hr><h2 id="居中偏移"><a href="#居中偏移" class="headerlink" title="居中偏移"></a>居中偏移</h2><p>看来约束布局对居中的需求是游刃有余啊，但是对于有美感追求的设计师来说，可能认为标准的居中会过于死板，他们希望你能把控件放在中间再往上偏移10%的位置，或者放在黄金分割比的位置。那么，约束布局要如何做到呢？</p><p>对约束布局来说，当一个控件设置了居中之后，可以使用Bias相关属性，Bias的默认值是0.5，代表控件居中摆放，可以通过改变这个值来让控件在水平或者竖直方向上做偏移。比如把Button A放置在父控件中心往上偏移10%的位置：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_bias_example.png" alt=""></p><p>可以通过设置竖直方向的Bias值来实现：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.4<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><hr><h2 id="中心的相对性"><a href="#中心的相对性" class="headerlink" title="中心的相对性"></a>中心的相对性</h2><p>需求不会永远都是中规中矩的，比如：以父控件为中心，摆个时钟造型出来。这样的需求普通的布局就没法实现了，可能需要我们自己去动态计算角度跟距离进行绘制，略显麻烦，但是对约束布局来说，它都给你实现好了：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/circle_accent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>12<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleAngle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleRadius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100dp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleAngle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleRadius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100dp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    ...(省略一些)    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>80dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@color/colorAccent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>rotation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>transformPivotX</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>transformPivotY</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>80dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleAngle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleRadius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>40dp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>View</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>60dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@color/colorAccent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>rotation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>60<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>transformPivotX</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>transformPivotY</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>60dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleAngle</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintCircleRadius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30dp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>这种布局方式称之为中心定位，效果如下图：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_circle_position_example.png" alt=""></p><hr><h2 id="外边距的调整"><a href="#外边距的调整" class="headerlink" title="外边距的调整"></a>外边距的调整</h2><p>继续探究，看下图，Button A、B、C、D、E、F相对摆放，分别标记A、C、E为GONE，观察此时B、D、F的行为：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_visibility_behavior.gif" alt=""></p><p>当有子控件被标记为GONE的时候，界面会重新布局，此时其它子控件的位置会相应的发生改变。我们可以把标记为GONE的子控件看成一个点，它对其它子控件的约束依然是成立的（但是自身的Margin属性都会被忽略），所以当A消失的时候，B会往左边移动。想一下，如果当A消失的时候，我们给B设置一个不同的Margin值，那么B的行为就跟D、F一样发生了变化。如果使用相对布局，我们可以在代码中通过LayoutParam动态设置Margin值来实现，但是约束布局就不一样了，它提供了这些属性。值得注意的是，这些属性在做一些简单的布局动画的时候相当有用。</p><hr><h2 id="百分比布局"><a href="#百分比布局" class="headerlink" title="百分比布局"></a>百分比布局</h2><p>Android的屏幕适配是个大问题，所以平常写布局的时候比较倾向于通过比例去指定控件的宽高，之前Google出过一个百分比的库，现在去看已经被标记为deprecated了，而替代品就是约束布局。一个简单的需求，Button A在屏幕的中间，宽是屏幕的一半，高是屏幕的1/8，在实现这个需求之前，我们需要先了解一下约束布局一般如何指定layout_width和layout_height：</p><ul><li>使用固定尺寸，例如123dp</li><li>使用WRAP_CONTENT，子控件计算自身尺寸</li><li>使用0dp，相当于”MATCH_CONSTRAINT”，在约束范围内所能占据的最大尺寸</li></ul><p>我们着重关注下0dp，以前我们对一个控件使用0dp的时候，一般是跟weight属性配合使用的，但是约束布局里面，它有着其他的含义，如下图，我们把A的左边约束在父控件的左边，A的右边约束在父控件的右边。图a，指定A的宽度为WRAP_CONTENT；图b，指定A的宽度为0dp；图c，指定A的宽度为0dp，并在其左边设置一定的margin值。</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_dimension.png" alt=""></p><p>MATCH_PARENT也是可以正常使用的，但是在约束布局里面推荐使用0dp然后约束在父控件两边来实现同等效果（如上图b）。</p><p>回到刚才的需求，Button A在屏幕的中间，宽是屏幕的一半，高是屏幕的1/8，我们可以这么实现（宽跟高必须设置为0dp）：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintWidth_percent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.5<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHeight_percent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.125<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_dimension_percent.png" alt=""></p><hr><h2 id="固定宽高比"><a href="#固定宽高比" class="headerlink" title="固定宽高比"></a>固定宽高比</h2><p>再来个需求，Button A在屏幕中心往上偏移20%的位置，并且宽高比固定为1:1，很显然，在约束布局中，这也是很容易就能实现的：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintDimensionRatio</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1:1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.3<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_dimension_ratio.png" alt=""></p><p>如上所示，要固定控件的宽高比，我们需要先设置宽或者高为0dp，被设置为0dp一边的尺寸，会根据ratio值以及另一边的尺寸进行计算得出。当然，如果宽跟高都设置为0dp的话，也是可以的，不过需要在ratio值前面增加”W”或者”H”来指定那一边会被约束。举个例子，比如我们实现一个首页的banner，宽度要跟屏幕相等，并且宽高比固定为16:9，因为宽必须跟屏幕相等，所以我们需要指定高被约束，即在ratio值前面加上”H”，如下：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.v4.view.ViewPager</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@color/colorAccent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintDimensionRatio</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>H,16:9<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_dimension_ratio_2.png" alt=""></p><hr><h2 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h2><p>再继续探索一下，我们上面所讨论的都是单个子控件的情况，但是时常会有这样的需求，比如，让Button A、B、C整体相对于父控件水平居中。传统的三把斧布局方式要实现这个需求那是相当简单，比如可以把A、B、C放进D里面，然后再把D居中于父控件即可；或者可以使用线性布局的gravity属性。但是，约束布局没有gravity属性，并且也不可能使用布局嵌套，那么它要怎么做到？</p><p>想让A、B、C整体居中于父控件，得先把它们看成一个整体，在约束布局中，我们可以把A、B、C看成是一个控件组，称之为链（Chains），根据需求，我们实现一条水平链：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_chain</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">Style</span></span><span class="token punctuation">="</span><span class="token attr-value">packed</span><span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>C<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_chains_packed.png" alt=""></p><p>控件链的第一个控件，称之为链头，如上面代码所示，我们可以在链头上设定chainStyle属性，来实现各种不同的效果，上图为了实现A、B、C整体居中的需求，使用的chainStyle是packed，在使用packed的时候，我们当然也可以在链头上使用Bias属性，实现中心偏移的需求：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_chains_styles.png" alt=""></p><p>实际上，chainStyle并没有weighted这个属性值，但是我们可以实现类似于线性布局weight属性的效果：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_chain</span><span class="token style-attr language-css"><span class="token attr-name"><span class="token attr-name">Style</span></span><span class="token punctuation">="</span><span class="token attr-value">packed</span><span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>3.0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2.0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>C<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_weight</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_%20chains_weighted.png" alt=""></p><hr><h2 id="Barrier"><a href="#Barrier" class="headerlink" title="Barrier"></a>Barrier</h2><p>因为约束布局讲究得是所有的子控件都平铺开来，而没有任何布局嵌套，所以对一些存在整体相对性的需求时，只能另辟蹊径。再看一个例子，如下图所示，上面有两个文本控件，内容是根据后台接口动态变化的，文本区域的下方，我们需要放一个Button：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_barrier_1.png" alt=""></p><p>现在我们开始开发，根据设计稿，分分钟就把布局写好了：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>maxWidth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>左边的文字......<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>右边的文字......<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/rect_round_accent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>按钮<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColorHint</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@color/app_white_70<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>得到的效果也跟设计稿相差无几，于是需求顺利完成了，但是过了一段时间之后，有人过来给你报了个bug，并提供了截图作为证据，如下：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_barrier_2.png" alt=""></p><p>通过分析发现，之前写布局的时候，因为设计稿里面左边文本控件看起来内容比较多，所以把Button约束在了左边文本控件的下面，但是这两个文本控件的内容不是固定的，公司的产品又需要支持多语言，当内容变化或者翻译成英文的时候，反而右边的文本控件内容比左边多了，这就导致了UI错误叠加的问题。那么这个问题约束布局如何解？</p><p>约束布局为了应对跟整体挂钩的需求，定义了多个虚拟的辅助类，这些虚拟的控件仅仅起到辅助布局的作用，并不占据任何空间。Barrier就是其中一员，它可以指定多个控件id，然后在某个方向施加一个屏障，这样其它的控件就可以在这个屏障上施加约束条件了。针对上面的需求，我们修改布局文件如下：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>padding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>maxWidth</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Barrier</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/barrier<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>barrierDirection</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>constraint_referenced_ids</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>a,b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginTop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/rect_round_accent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColor</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:color/white<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textColorHint</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@color/app_white_70<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/barrier<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>效果如下：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_barrier_3.png" alt=""></p><hr><h2 id="Guideline"><a href="#Guideline" class="headerlink" title="Guideline"></a>Guideline</h2><p>辅助控件Guideline，跟Barrier比较相似，它们的区别在于，Barrier需要指定多个控件，它的位置会根据这些控件尺寸的改变而改变。但是Guideline的位置是固定的，固定的位置可以是具体的尺寸也可以是相对于父控件的百分比，我们可以在水平或者竖直方向设置Guideline。比如，在父控件30%的地方设置一个水平方向的Guideline，然后Button A、B、C分别约束在这个Guideline的上下两侧：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Guideline</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintGuide_percent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.3<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>C<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_guideline.png" alt=""></p><p>Guideline的使用场景也是相当多的，举个例子，一般我们设置margin都是固定dp值，但是如果想以父控件尺寸的百分比作为margin值，Guideline就能发挥作用了。</p><hr><h2 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h2><p>想一下，约束布局如果想让多个子控件同时标记为GONE或者VISIBLE，因为没有布局嵌套了，是否要一个一个地操作，那未免也太蠢了，所以就有了Group这个辅助控件，它可以指定多个子控件，来整体控制它们的可见性，举例如下：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Guideline</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>horizontal<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintGuide_percent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0.3<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/b<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>B<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/c<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>C<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/guideline<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/b<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Group</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/group<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>visibility</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>gone<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>constraint_referenced_ids</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>b,c<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_group.png" alt=""></p><hr><h2 id="Placeholder"><a href="#Placeholder" class="headerlink" title="Placeholder"></a>Placeholder</h2><p>另外一个辅助控件Placeholder，它相当于一个占位符，可以通过指定一个其它的控件id来显示具体的内容，一个非常简单的例子：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText, ContentDescription<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>A<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/a<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>在约束布局中，一个控件必须在水平和竖直方向至少各施加一个约束，但是很显然上面的Button A并没有施加任何约束。我们在下面的Placehoder辅助控件中指定了Button A的id，看看预览图：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_placeholder.png" alt=""></p><p>可以看出，Button A的位置显示在了Placeholder的位置上，很容易理解，但是我们需要思考一下，这个辅助控件的使用场景。首先，因为Placeholder的特性，我们可以把它应用在布局模版上面，是的，代码有template，布局也可以有template，比如我们写一个首页的布局模版：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>merge</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>parentTag</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>android.support.constraint.ConstraintLayout<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintTop_toTopOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/template_tab_2<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_2<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_2<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/template_tab_3<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/template_tab_1<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_3<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_3<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toStartOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_4<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_2<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.Placeholder</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_4<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_marginBottom</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>10dp<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@id/tab_4<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintEnd_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintStart_toEndOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/template_tab_3<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>merge</span><span class="token punctuation">></span></span></code></pre><p>布局模版写好了，我们可以把它放进公共库里面，如果要新开发一个首页，那么我们就可以使用模版了，模版里面所有控件的位置都已经固定，我们需要做的就是往里面添东西，举个例子：</p><pre class=" language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>     <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span>    <span class="token attr-name"><span class="token namespace">tools:</span>ignore</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>HardcodedText,ContentDescription<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span> <span class="token attr-name">layout</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@layout/template_constraint_placeholder<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>textSize</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20sp<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_1<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/tree<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_2<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/camping_tent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_3<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/boat<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ImageView</span>        <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@+id/tab_4<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span>        <span class="token attr-name"><span class="token namespace">android:</span>src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/television<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span></code></pre><p>我们首先把模版include进来，然后根据所设置的id，把所有控件添加进去就可以了，此时不用再为这些控件设置约束条件，因为模版里面已经封装好了，效果：</p><p><img src="http://thismj.nos-eastchina1.126.net/image/post_constraints_placeholder_template.png" alt=""></p><p>Placeholder是否可以用在页面加载占位图上面？</p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>综上所述，ConstraintLayout基本集合了常用布局的所有特性，针对复杂的布局，可以最大限度地减少嵌套问题。</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Layout </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac OS之Android源码下载、编译、刷机</title>
      <link href="/2018/09/13/ji-zhu-mac-os-zhi-android-yuan-ma-xia-zai-bian-yi-shua-ji/"/>
      <url>/2018/09/13/ji-zhu-mac-os-zhi-android-yuan-ma-xia-zai-bian-yi-shua-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="软硬件环境"><a href="#软硬件环境" class="headerlink" title="软硬件环境"></a>软硬件环境</h2><ul><li>系统版本：Mac OS High Sierra 10.13.2 (17C88)</li><li>刷机硬件：Nexus 6</li><li>AOSP分支：android-7.1.1_r57（NGI77B）</li></ul><h2 id="搭建Mac编译环境"><a href="#搭建Mac编译环境" class="headerlink" title="搭建Mac编译环境"></a>搭建Mac编译环境</h2><p>通过shell使用以下命令创建大小写敏感的稀疏磁盘映像（官网写的40g是远远不够的）:</p><pre class=" language-bash"><code class="language-bash">hdiutil create -type SPARSE -fs <span class="token string">'Case-sensitive Journaled HFS+'</span> -size 150g ~/android.dmg</code></pre><p>在~/.bash_profile添加以下两个辅助函数，记得source一下：</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 装载Android磁盘映像</span>mountAndroid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> hdiutil attach ~/android.dmg.sparseimage -mountpoint /Volumes/android<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token comment" spellcheck="true"># 卸载Android磁盘映像</span>umountAndroid<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> hdiutil detach /Volumes/android<span class="token punctuation">;</span> <span class="token punctuation">}</span></code></pre><p>安装 Xcode 软件，可以选择 8.3.3 版本，安装最新的 9.x 后面编译会有问题。<br>安装 Xcode 命令行工具：</p><pre class=" language-bash"><code class="language-bash">xcode-select --install</code></pre><p>安装<a href="https://www.macports.org/install.php" target="_blank" rel="noopener">MacPorts</a>，确保 /opt/local/bin 在路径中显示在 /usr/bin 前面：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">export</span> PATH<span class="token operator">=</span>/opt/local/bin:<span class="token variable">$PATH</span></code></pre><p>通过 MacPorts 获取 Make、Git 和 GPG 软件包：</p><pre class=" language-bash"><code class="language-bash">POSIXLY_CORRECT<span class="token operator">=</span>1 <span class="token function">sudo</span> port <span class="token function">install</span> gmake libsdl <span class="token function">git</span> gnupg</code></pre><p>然后设置文件描述符数量上限：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">ulimit</span> -S -n 1024</code></pre><h2 id="下载AOSP-Android-Open-Source-Project"><a href="#下载AOSP-Android-Open-Source-Project" class="headerlink" title="下载AOSP(Android Open Source Project)"></a>下载AOSP(Android Open Source Project)</h2><p>装载Android磁盘映像：</p><pre class=" language-bash"><code class="language-bash">mountAndroid</code></pre><p>安装配置repo，并初始化repo项目：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> ~<span class="token function">mkdir</span> ~/bin<span class="token function">export</span> PATH<span class="token operator">=</span>~/bin:<span class="token variable">$PATH</span>curl https://storage.googleapis.com/git-repo-downloads/repo <span class="token operator">></span> ~/bin/repo<span class="token function">chmod</span> a+x ~/bin/repo<span class="token function">cd</span> /Volumes/android<span class="token function">mkdir</span> AOSP<span class="token function">cd</span> AOSP<span class="token function">git</span> config --global user.name <span class="token string">"thismj"</span><span class="token function">git</span> config --global user.email <span class="token string">"thiscrazymj@gmail.com"</span><span class="token comment" spellcheck="true">#可以翻墙（Google）</span>repo init -u https://android.googlesource.com/platform/manifest -b android-7.1.1_r57<span class="token comment" spellcheck="true">#翻不了墙（清华AOSP镜像）</span>repo init -u https://aosp.tuna.tsinghua.edu.cn/platform/manifest -b android-7.1.1_r57</code></pre><p>下载同步源代码，大概30多个g，这个时候只能慢慢等，公司网比较慢，花了10多个小时，家里不到3小时搞定：</p><pre class=" language-bash"><code class="language-bash">repo <span class="token function">sync</span></code></pre><h2 id="编译源代码"><a href="#编译源代码" class="headerlink" title="编译源代码"></a>编译源代码</h2><p>下载对应分支（android-7.1.1_r57）、对应设备（Nexus 6）的二进制驱动文件，如下图：<br><img src="https://thismj.nos-eastchina1.126.net/image/post_aosp_ngi77b_binaries.png" alt=""><br>下载完成后解压到AOSP源代码目录，得到3个sh脚本，依次执行，最后一行输入”I ACCEPT”同意许可证条款，二进制文件及其对应的 Makefile 将会安装在AOSP的vendor目录下</p><p>执行编译前清理：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">make</span> clobber</code></pre><p>初始化编译环境：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">source</span> build/envsetup.sh</code></pre><p>lunch选择<a href="https://source.android.com/setup/build/running.html#selecting-device-build" target="_blank" rel="noopener">编译目标</a>，因为我用的是 Nexus 6，所以执行命令如下：</p><pre class=" language-bash"><code class="language-bash">lunch aosp_shamu-userdebug</code></pre><p>使用 make 命令编译代码，借助 -jN 参数指定同时编译的任务数量，一般设置为CPU支持并发线程总数的1-2倍</p><pre class=" language-bash"><code class="language-bash"><span class="token function">make</span> -j8</code></pre><p>编译完成后终端输出，喜闻乐见只花了1小时4分25秒：</p><pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#### make completed successfully (01:04:25 (hh:mm:ss)) ####</span></code></pre><h2 id="刷机"><a href="#刷机" class="headerlink" title="刷机"></a>刷机</h2><p>首先在开发者模式下打开OEM解锁：<br><img src="https://thismj.nos-eastchina1.126.net/image/post_aosp_oem.png" alt=""><br>adb进入 fastboot 模式：</p><pre class=" language-bash"><code class="language-bash">adb <span class="token function">reboot</span> bootloader</code></pre><p>解锁 bootloader：</p><pre class=" language-bash"><code class="language-bash">fastboot oem unlock</code></pre><p>刷机，-w 选项会清除 /data 分区：</p><pre class=" language-bash"><code class="language-bash">fastboot flashall -w</code></pre><p>不到1分钟，刷机成功，喜大普奔！检查下手机系统版本：<br><img src="https://thismj.nos-eastchina1.126.net/image/post_aosp_check_version.png" alt=""></p><h2 id="踩坑记录"><a href="#踩坑记录" class="headerlink" title="踩坑记录"></a>踩坑记录</h2><p>1、踩坑之一</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">Error: gnupg has been deprecated. If you absolutely want to stay on the classic version, <span class="token function">install</span> the gnupg1 port. All other <span class="token function">users</span> are recommended to <span class="token function">install</span> gnupg2.Error: Failed to configure gnupg: obsolete portError: See /opt/local/var/macports/logs/_opt_local_var_macports_sources_rsync.macports.org_macports_release_tarballs_ports_mail_gnupg/gnupg/main.log <span class="token keyword">for</span> details.Error: Follow https://guide.macports.org/<span class="token comment" spellcheck="true">#project.tickets to report a bug.</span>Error: Processing of port gnupg failed</code></pre><p>解决办法：卸载gnupg1，安装gnupg2：</p><pre class=" language-bash"><code class="language-bash">POSIXLY_CORRECT<span class="token operator">=</span>1 <span class="token function">sudo</span> port uninstall gnupg1   POSIXLY_CORRECT<span class="token operator">=</span>1 <span class="token function">sudo</span> port <span class="token function">install</span> gmake libsdl <span class="token function">git</span> gnupg2  </code></pre><p>——————<br>2、踩坑之二<br>原因：AOSP比较庞大，repo sync容易发生错误导致同步中断，使用shell脚本<br>解决办法：使用sh脚本</p><pre class=" language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>repo <span class="token function">sync</span><span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$?</span> -ne 0 <span class="token punctuation">]</span><span class="token keyword">do</span>repo <span class="token function">sync</span><span class="token keyword">done</span></code></pre><p>——————<br>3、踩坑之三</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">build/core/combo/mac_version.mk:26: none of the installed SDKs <span class="token punctuation">(</span>ac_sdk_versions_installed<span class="token punctuation">)</span> match supported versions <span class="token punctuation">(</span>10.8 10.9 10.10 10.11<span class="token punctuation">)</span>, trying 10.8build/core/combo/mac_version.mk:36: no SDK 10.8 at /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.8.sdk, trying legacy <span class="token function">dir</span>build/core/combo/mac_version.mk:40: *****************************************************build/core/combo/mac_version.mk:41: * Can not <span class="token function">find</span> SDK 10.8 at /Developer/SDKs/MacOSX10.8.sdkbuild/core/combo/mac_version.mk:42: *****************************************************build/core/combo/mac_version.mk:43: *** Stop<span class="token punctuation">..</span>  Stop.</code></pre><p>解决办法：</p><p>查看build/core/combo/mac_version.mk:</p><pre class=" language-bash"><code class="language-bash">mac_sdk_versions_supported :<span class="token operator">=</span>  10.8 10.9 10.10 10.11</code></pre><p>下载<a href="https://github.com/phracker/MacOSX-SDKs/releases/download/10.13/MacOSX10.11.sdk.tar.xz" target="_blank" rel="noopener">MacOSX10.11.sdk</a>，完成后解压，放在下面两个目录：</p><pre><code>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/</code></pre><pre><code>~/Document/</code></pre><p>最后创建软链接：</p><pre class=" language-bash"><code class="language-bash"><span class="token function">ln</span> -s ~/Document/MacOSX10.11.sdk /Applications/XCode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk</code></pre><p>——————<br>4、踩坑之四</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">build/core/config.mk:600: *** Error: could not <span class="token function">find</span> jdk tools.jar at /System/Library/Frameworks/JavaVM.framework/Versions/Current/Commands/<span class="token punctuation">..</span>/lib/tools.jar, please check <span class="token keyword">if</span> your JDK was installed correctly.  Stop.</code></pre><p>解决办法：设置ANDROID_JAVA_HOME环境变量</p><pre class=" language-bash"><code class="language-bash"><span class="token function">export</span> JAVA_HOME<span class="token operator">=</span>/Library/Java/JavaVirtualMachines/jdk1.8.0_172.jdk/Contents/Home<span class="token function">export</span> ANDROID_JAVA_HOME<span class="token operator">=</span><span class="token variable">$JAVA_HOME</span></code></pre><p>——————<br>5、踩坑之五</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">ninja: Entering directory `.'ninja: warning: multiple rules generate out/target/product/shamu/system/etc/gps.conf. builds involving this target will not be correct<span class="token punctuation">;</span> continuing anyway <span class="token punctuation">[</span>-w dupbuild<span class="token operator">=</span>warn<span class="token punctuation">]</span><span class="token punctuation">[</span>  0% 22/33752<span class="token punctuation">]</span> Yacc: aidl <span class="token operator">&lt;=</span> system/tools/aidl/aidl_language_y.yyFAILED: /bin/bash -c <span class="token string">"prebuilts/misc/darwin-x86/bison/bison -d  --defines=out/host/darwin-x86/obj/STATIC_LIBRARIES/libaidl-common_intermediates/aidl_language_y.h -o out/host/darwin-x86/obj/STATIC_LIBRARIES/libaidl-common_intermediates/aidl_language_y.cpp system/tools/aidl/aidl_language_y.yy"</span><span class="token punctuation">[</span>  0% 22/33752<span class="token punctuation">]</span> host Java: tagsouplib <span class="token punctuation">(</span>out/host/common/obj/JAVA_LIBRARIES/tagsouplib_intermediates/classes<span class="token punctuation">)</span>注: 某些输入文件使用了未经检查或不安全的操作。注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。<span class="token punctuation">[</span>  0% 22/33752<span class="token punctuation">]</span> host Java: antlr-runtime <span class="token punctuation">(</span>out/host/common/obj/JAVA_LIBRARIES/antlr-runtime_intermediates/classes<span class="token punctuation">)</span>注: 某些输入文件使用了未经检查或不安全的操作。注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。ninja: build stopped: subcommand failed.make: *** <span class="token punctuation">[</span>ninja_wrapper<span class="token punctuation">]</span> Error 1<span class="token comment" spellcheck="true">#### make failed to build some targets (38 seconds) ####</span></code></pre><p>解决办法：<br>编辑prebuilts/sdk/tools/jack-admin文件</p><pre class=" language-bash"><code class="language-bash">JACK_SERVER_COMMAND<span class="token operator">=</span><span class="token string">"java -XX:MaxJavaStackTraceDepth=-1 -Djava.io.tmpdir=<span class="token variable">$TMPDIR</span> <span class="token variable">$JACK_SERVER_VM_ARGUMENTS</span> -cp <span class="token variable">$LAUNCHER_JAR</span> <span class="token variable">$LAUNCHER_NAME</span>"</span></code></pre><p>修改为</p><pre class=" language-bash"><code class="language-bash">JACK_SERVER_COMMAND<span class="token operator">=</span><span class="token string">"java -XX:MaxJavaStackTraceDepth=-1 -Djava.io.tmpdir=<span class="token variable">$TMPDIR</span> <span class="token variable">$JACK_SERVER_VM_ARGUMENTS</span> -Xmx4096m -cp <span class="token variable">$LAUNCHER_JAR</span> <span class="token variable">$LAUNCHER_NAME</span>"</span></code></pre><p>然后依次执行：</p><pre class=" language-bash"><code class="language-bash">./prebuilts/sdk/tools/jack-admin stop-server./prebuilts/sdk/tools/jack-admin start-server</code></pre><p>——————<br>6、踩坑之六</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">Jack server installation not found</code></pre><p>解决办法：</p><pre class=" language-bash"><code class="language-bash">./prebuilts/sdk/tools/jack-admin install-server jack-launcher.jar jack-server-4.8.ALPHA.jar </code></pre><p>执行命令后提示警告，暂时没管。</p><pre class=" language-bash"><code class="language-bash">Warning:JKS 密钥库使用专用格式。建议使用 <span class="token string">"keytool -importkeystore -srckeystore /Users/aero.tang/.jack-server/server.jks -destkeystore /Users/aero.tang/.jack-server/server.jks -deststoretype pkcs12"</span> 迁移到行业标准格式 PKCS12。Warning:JKS 密钥库使用专用格式。建议使用 <span class="token string">"keytool -importkeystore -srckeystore /Users/aero.tang/.jack-server/client.jks -destkeystore /Users/aero.tang/.jack-server/client.jks -deststoretype pkcs12"</span> 迁移到行业标准格式 PKCS12。</code></pre><p>——————<br>7、踩坑之七</p><p>错误：</p><pre class=" language-bash"><code class="language-bash">external/libcxx/include/cstdlib:167:44: error: declaration conflicts with target of using declaration already <span class="token keyword">in</span> scopeexternal/libcxx/include/cstdlib:169:44: error: declaration conflicts with target of using declaration already <span class="token keyword">in</span> scopeexternal/libcxx/include/cstdlib:172:42: error: declaration conflicts with target of using declaration already <span class="token keyword">in</span> scopeexternal/libcxx/include/cstdlib:174:42: error: declaration conflicts with target of using declaration already <span class="token keyword">in</span> scope<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></code></pre><p>解决办法：见<a href="https://stackoverflow.com/questions/47060910/error-declaration-conflicts-with-target-of-using-declaration-already-in-scope" target="_blank" rel="noopener">stackoverflow</a>，Xcode降级到8.3.3<br>——————<br>8、踩坑之八</p><p>原因：High Sierra系统下bison有关于动态格式化字符串的bug，具体见<a href="https://android-review.googlesource.com/c/platform/external/bison/+/517740" target="_blank" rel="noopener">Bison Patch</a></p><pre class=" language-bash"><code class="language-bash">FAILED: /bin/bash -c <span class="token string">"prebuilts/misc/darwin-x86/bison/bison -d  --defines=out/host/darwin-x86/obj/STATIC_LIBRARIES/libaidl-common_intermediates/aidl_language_y.h -o out/host/darwin-x86/obj/STATIC_LIBRARIES/libaidl-common_intermediates/aidl_language_y.cpp system/tools/aidl/aidl_language_y.yy"</span></code></pre><p>解决办法：AOSP源代码目录执行</p><pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /external/bison<span class="token function">git</span> cherry-pick c0c852bd6fe462b148475476d9124fd740eba160mm<span class="token function">cp</span> /out/host/darwin-x86/bin/bison /prebuilts/misc/darwin-x86/bison/</code></pre><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ol><li><a href="https://source.android.com/setup/build/initializing" target="_blank" rel="noopener">搭建编译环境</a></li><li><a href="https://source.android.com/setup/start/build-numbers.html#source-code-tags-and-builds" target="_blank" rel="noopener">代号、标签和版本号</a></li><li><a href="https://source.android.com/setup/build/downloading" target="_blank" rel="noopener">下载源代码</a></li><li><a href="https://source.android.com/setup/build/building" target="_blank" rel="noopener">准备编译</a></li><li><a href="https://source.android.com/setup/build/building#run-it" target="_blank" rel="noopener">开始运行</a></li><li><a href="https://source.android.com/setup/develop/repo.html" target="_blank" rel="noopener">Repo 命令参考资料</a></li><li><a href="https://developers.google.com/android/drivers" target="_blank" rel="noopener">Nexus、Pixel设备的二进制驱动文件列表</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AOSP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
